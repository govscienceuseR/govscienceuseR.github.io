<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Liza Wood" />
<meta name="author" content="Tyler A. Scott" />


<title>The science informing California’s Groundwater Sustainability Plans</title>

<script src="site_libs/header-attrs-2.19/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-1.6.0/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="site_libs/datatables-binding-0.26/datatables.js"></script>
<link href="site_libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="site_libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="site_libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">govscienceuseR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="gsp_vignette.html">Vignettes</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">The science informing California’s
Groundwater Sustainability Plans</h1>
<h3 class="subtitle">A test case using <code>govscienceuseR</code>
tools</h3>
<h4 class="author">Liza Wood</h4>
<h4 class="author">Tyler A. Scott</h4>

</div>


<div id="introduction" class="section level3">
<h3>Introduction</h3>
<p>Understanding the policy that goes into science is important…<br />
Sarewitz Cairney - supply demand mismatch, inability of technical
solutions to resolve political controversies</p>
<p>However, it can be a tedious task… Koontz looks in depth at 12 plans,
1,104 references across them, but these include all kinds of sources:
scholarly, articles, organizations, agencies at different levels, etc.
Desmaris and Herd (2014) 102 Regulatory Impact Assessments, describing
1,378 scholarly citations, and though recognizing the significant
presence of non-scholarly citations, they do not anylze those</p>
</div>
<div id="method" class="section level3">
<h3>Method</h3>
<p>This is vignette walking through the steps of the R packages in the
<code>govscienceuseR</code> tool set: <code>referenceExtract</code>,
<code>referenceClassify</code>, <code>indexBuild</code>, and
<code>referenceSearch</code>. Together, these four packages allow
researchers to go from PDF documents to a data frame of indexed
citations in only a handful of steps in the R coding language. The goal
of these tools is to allow researchers working with various types of
policy documents to analyze citations using a systematic and
reproducible approach.</p>
</div>
<div id="the-case" class="section level3">
<h3>The case</h3>
<p>Sustainable Groundwater Management Act… The data we’ll be using are
documents for California’s Groundwater Sustainability Plans. These
documents are Groundwater Sustainability Agency-level plans, developed
in response to the state’s Sustainable Ground Management Act. Passed in
2014, SGMA has required that GSAs (‘Agencies’) develop plans to meeting
various sustainability goals for groundwater, including… As such, these
documents provide a useful case for evaluating the use of science in
policy, as there are a variety of…</p>
</div>
<div id="getting-started" class="section level3">
<h3>Getting started</h3>
<p><strong>Installations</strong></p>
<p>Let’s get started by downloading all four packages from the <a
href="https://github.com/govscienceuseR">govscienceuseR GitHub
page</a>:</p>
<pre class="r"><code>devtools::install_github(&quot;govscienceuseR/referenceExtract&quot;)
devtools::install_github(&quot;govscienceuseR/referenceClassify&quot;)
devtools::install_github(&quot;govscienceuseR/referenceBuild&quot;)
devtools::install_github(&quot;govscienceuseR/citationSearch&quot;)</code></pre>
<p>Then load these, and dependent packages, into library. [<strong>Note:
All of the dependent packages required should be imported when we load
in these packages, but they currently aren’t</strong>]. You may be
prompted to install some of the dependent packages if you do not already
have them, such as <code>keras</code>.</p>
<pre class="r"><code>library(referenceExtract)
library(referenceClassify)
library(referenceBuild)
library(citationSearch)
packs = c(&#39;data.table&#39;, &#39;dplyr&#39;, &#39;stringr&#39;, &#39;keras&#39;, &#39;tensorflow&#39;,
          &#39;tidyr&#39;, &#39;purrr&#39;)
sapply(packs, require, character.only = T)</code></pre>
<p>You’ll also need to install <a
href="https://solr.apache.org">Solr</a> for the final step of the
process.</p>
<p><strong>Data</strong></p>
<p>The data we’ll be using are documents for California’s Groundwater
Sustainability Plans. These documents are available publicly to download
from <a
href="https://ucdavis.box.com/s/9m3dogbibkrwy01pg4sdwouhzl8i6sef">Box</a>.
Feel free to download them to your computer to a file that will be
considered your document directory. There are 114 plans, which total
over 160,000 pages. We will set our document directory to this folder of
PDFs.</p>
<pre class="r"><code>doc_directory &lt;- &quot;~/Box/reference_classifier/documents_gsp/&quot;</code></pre>
<p>Using these GSP documents we’ll be walking through the following
steps of the process:</p>
<p><img src="img/workflow.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="referenceextract" class="section level3">
<h3>1. <code>referenceExtract</code></h3>
<p>The <code>referenceExtract</code> package from govscienceuseR is
designed to take unstructured PDF documents, feed them through the <a
href="https://anystyle.io/">anystyle.io</a> citation extraction
software, and return tagged citation data in a tabular format.</p>
<div id="reference_extract" class="section level4">
<h4><code>reference_extract()</code></h4>
<p>The first step of extracting references is to input PDF documents
into the <code>reference_extract()</code> function. This function reads
in every PDF in the document directory (doc_dir), and runs them through
anystyle.io. Anystyle extracts probable citations and exports them to
the reference directory (ref_dir) as JSON files. Depending on the number
and size of files, this can take some time. For example, these 114
documents took over an hour to extract.</p>
<pre class="r"><code># Extract probable citations from PDF documents and convert them to .json files
ref_directory &lt;- &quot;data/ref_dir&quot;
reference_extract(doc_dir = doc_directory, 
                 ref_dir = ref_directory, 
                 layout = &quot;none&quot;)</code></pre>
</div>
<div id="reference_compile" class="section level4">
<h4><code>reference_compile()</code></h4>
<p>Next, the <code>reference_compile()</code> function transforms the
JSON files into tabular data and compiles them all in one data table,
adding the file name as an identifier.</p>
<pre class="r"><code># Compile json files into a singular tabular data table
dt &lt;- reference_compile(ref_directory)</code></pre>
<p>After these first two steps we can take a look at our probable
citations according to the Anystyle software. Initially, there are 26528
probable citations across these 114 documents.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-cd16cc3dca84f90effce" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-cd16cc3dca84f90effce">{"x":{"filter":"none","vertical":false,"data":[[{"family":["Ayers","Westcot"],"given":["R.S.","D.W."]},null,null,null,null,{"family":["Water Resources"],"given":["California Department"],"particle":["of"]},{"family":["Water Resources"],"given":["California Department"],"particle":["of"]},null,null,{"family":["Daly","Neilson","Phillips"],"given":["C.","R.P.","D.L."]},{"family":["Davis","Green","Olmsted","Brown"],"given":["G.H.","J.H.","F.H.","D.W."]},null,{"given":["Sink","G.H.","Z.A."],"family":[null,"Hargreaves","Samani"]},{"family":["Hopkins","B"],"given":["J.","Anderson"]},{"family":["Schmidt",null],"given":["Kenneth D.","Associates"]},{"family":["MacGillivray"],"given":["N.A."]},{"family":["County"],"given":["Madera"]},{"family":["County"],"given":["Madera"]},null,{"family":["Hayes","Eching"],"given":["S.","S."]},{"family":["Page"],"given":["R.W."]},{"given":["Provost","Pritchard Consulting"],"family":[null,"Group"]},{"family":["Program"],"given":["San Joaquin River Restoration"]},null,{"family":["Program"],"given":["San Joaquin River Restoration"]},{"family":["Board"],"given":["State Water Resources Control"]},{"family":["Agency"],"given":["U.S.Environmental Protection"]},{"given":["U.S.G.S."]},{"family":["Williamson","Prudic","Swain"],"given":["A.K.","D.E.","L.A."]},{"given":["A.E.C.O.M."]},null,{"family":["Belitz","Heimes"],"given":["K.","F.J."]},{"family":["Bertoldi","Johnston","Evenson"],"given":["G.L.","R.H.","K.D."]},{"literal":["–"]},{"family":["Borchers","Carpenter"],"given":["J.W.","M."]},{"family":["Assembly"],"given":["California"]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{"family":["Board"],"given":["California State Water Resources Control"]},null,null,{"given":["Caltrans"]},null,{"given":["Caltrans"]},null,{"family":["Corwin"],"given":["D.L."]},{"family":["Croft"],"given":["M.G."]},null,{"family":["Davis","Poland"],"given":["G.H.","J.F."]},{"family":["Davis","Green","Olmstead","Brown"],"given":["G.H.","J.H.","S.H.","D.W."]},{"family":["Davis","Lofgren","Mack"],"given":["G.H.","B.E.","S."]},null,null,{"family":["Farr","Jones","Lieu"],"given":["Tom G.","Cathleen E.","Zhen"]},null,null,{"family":["Farrar","Bertoldi"],"given":["C.D.","G.L."]},{"family":["Faunt","Hanson","Belitz","Schmid","Predmore","Rewis","McPherson"],"given":["C.","R.T.","K.","W.","S.","D.L.","K."]},{"family":["Faunt","Belitz.","Hanson","Survey"],"given":["C.C.","K.","R.T.","Geological"]},{"family":["Faunt","Sneed","Traum","Brandt"],"given":["C.C.","M.","J.","J.T."]},{"family":["Fio"],"given":["J.L."]},{"family":["Foss","Blaisdell"],"given":["F.D.","R."]},{"family":["Galloway","Riley"],"given":["D.L.","F.S."]},{"family":["Galloway","Jones","Ingebritsen"],"given":["D.L.","D.R.","S.E."]},{"family":["Hotchkiss"],"given":["W.R."]},null,{"family":["Hotchkiss","Balding"],"given":["W.R.","G.O."]},{"family":["Ireland"],"given":["R.L."]},{"family":["R.L.","Poland","Riley"],"given":["Ireland","J.F.","F.S."]},{"family":["Jacob"],"given":["C.E."]},{"family":["Jennings","Strand"],"given":["C.W.","R.G."]},null,{"family":["Mendenhall","Dole","Stabler"],"given":["W.C.","R.B.","H."]},{"given":["Luhdorff","Scalmanini Consulting"],"family":[null,"Engineers"]}],[["1985","XXXX"],["2003"],null,["1981-12"],["1991-06"],["2016-12","2016-12"],["2017","XXXX"],["1949","XXXX"],["2019"],["1994"],["1959"],["2017-08-06"],["1982"],["2016-09"],["2013"],["1989"],["1995-10-24","2008"],["2019"],["2002","2006"],["2013"],["1973"],["2017-05-15"],["2014","2018"],["2019"],["XXXX"],["2018","2013"],["2006","2014","1969"],["XXXX"],["1989"],["2011"],["2018-07-25"],["1990"],["1991"],null,["2014-04"],["2014","1471"],null,["2013"],null,["2016"],null,["1965"],["1981"],null,null,["1998"],["2003"],null,["2017-06"],null,["2017"],null,["2018-05"],["2018"],null,["2018-07"],null,["2017-07-17"],["2018"],["2018"],["2019"],["2018-06"],null,["1977"],["2011"],null,null,["2017"],null,["2018"],null,["2012"],["1972","1999"],["2019-08"],["1957"],["1959"],["1964"],["2017"],["2018-07-26"],["2017"],["2015 – September 2016"],null,["1988"],["2009"],["2010"],["2015"],["1994"],["1968"],["1999"],["1999"],["1972"],["2019-08"],["1971"],["1986"],["1984"],["1940"],["1958"],null,["1916"],["2011"]],[["Water Quality for Agriculture (FAO 29). Food and Agriculture Organization of the United Nations"],["California Department of Water Resources (DWR","California’s Groundwater Bulletin"],null,["California Department of Water Resources (DWR","California Water Well Standards"],["California Department of Water Resources (DWR","California Water Well Standards: Supplement to Bulletin 74-81"],["Monitoring Networks and Identification of Data Gaps BMP","Monitoring Protocols, Standards, and Sites BMP"],["Draft Sustainable Management Criteria Best Management Practices","a_2017-11-06.pdf California Department of Water Resources","SGMA Data Viewer for Land Subsidence"],["California Open Data Portal","NASA JPL InSAR Subsidence Data"],null,["A statistical-topographic model for mapping climatological precipitation over mountainous terrain"],["Ground-Water Conditions and Storage Capacity in the San Joaquin Valley California"],null,["Estimating potential evapotranspiration"],["A Field Manual for Groundwater-level Monitoring at the Texas Water Development Board, User Manual 52"],["Aliso Water District Groundwater Management Plan AB 303 Plan for Aliso Water District"],["Effective precipitation: a field study to assess consumptive use of winter rains by spring and summer crops"],["Madera County General Plan Policy Document","Madera County"],["Madera County Municipal Code"],["San Joaquin River Restoration Study Background Report, prepared for Friant Water Users Authority, Lindsay, CA, and Natural Resources Defense Council","Natural Resources Defense Council v","San Joaquin River Restoration Settlement"],["California simulation of evapotranspiration of applied water and agricultural energy use in California"],["Base of Fresh Groundwater (Approximately 3,000 Micromhos) in the San Joaquin Valley, California"],null,["Seepage Management Plan, http://www.restoresjr.net/wp-content/uploads/2018/02/SMP_Draft_September_2014.pdf San Joaquin River Restoration Program (SJRRP","Channel Capacity Report 2018 Restoration Year. http://www.restoresjr.net/restoration-flows/levee-stability-channel-capacity/ San Joaquin River Restoration Program website"],null,["Water Quality"],["Aliso Water District – Application to Appropriate Water","otices/2018/t032962_app.pdf Tetra Tech","San Joaquin River and Bypass System 1-D Steady State HEC-RAS Model Documentation"],["Guidance on Systematic Planning Using the Data Quality Objectives Process","ess.pdf United States Bureau of Reclamation (USBR","Upper San Joaquin River Basin Storage Investigation","Contract Between the United Stated of America and the Newhall Land and Farming Company for Groundwater Pumping"],["Land Subsidence in California"],["Groundwater Flow in the Central Valley, California. United States Geological Survey","*Note references for the Hydrogeologic Conceptual Model and Groundwater Conditions for the Aliso Water District GSP (sections 3.1 and 3.2) are included at the end of Appendix A"],["Groundwater Management Plan for the Northern Agencies in the Delta-Mendota Canal Service Area"],null,["Character and Evolution of Ground-Water flow System in the Central Part of the Western San Joaquin Valley, California"],["Ground water in the"],["A Summary Report"],["Land Subsidence from Groundwater Use in California"],["Assembly Bill No","Water Quality, Supply, and Infrastructure Improvements Act of 2014"],["California Department of Conservation, California Geologic Survey. Various dates. Faults shapefiles"],["California Department of Fish and Wildlife","California Lakes shapefile"],null,["California Department of Fish and Wildlife","California Streams shapefile"],null,["California Department of Water Resources (DWR","San Joaquin Valley Drainage Investigation –San Joaquin Master Drain"],["California Department of Water Resources (DWR","Water Well Standards: State of California, Bulletin 74-81"],["California Department of Water Resources (DWR). 1991"],null,["California Department of Water Resources (DWR","The California Water Plan Update"],["California Department of Water Resources (DWR","California’s Groundwater Bulletin 118 –Update 2003"],null,["California Department of Water Resources (DWR","California Aqueduct Subsidence Study"],null,["California Department of Water Resources (DWR","DRAFT Best Management Practices for the"],["Sustainable Management of Groundwater: Sustainable Management Criteria BMP"],["California Department of Water Resources (DWR","Evaluation of the Effect of Subsidence on Flow Capacity in the Chowchilla and Eastside Bypasses, and Reach 4A of the"],["Received via personal communication with Alexis R"],null,["California Department of Water Resources (DWR","Water Data Library database"],["California Department of Water Resources (DWR). 2018a"],null,["California Department of Water Resources (DWR","Economically Distressed Areas Mapping Tool"],["California Department of Water Resources (DWR","Natural Communities Commonly Associated with Groundwater (NCCAG) dataset"],["California Department of Water Resources (DWR","CA Bulletin 118 Groundwater Basins shapefile"],["California Natural Resources Agency","NASA JPL InSAR Subsidence Data"],null,["California State Water Resources Control Board (SWRCB","San Joaquin Valley Interagency Drainage Program Environmental Assessment – Phase I. Prepared for the California State Water Resources Control Board by Environmental Impact Planning Corporation"],["CV-SALTS Lower San Joaquin River Committee, April 28, 2011 Meeting Materials, Agenda Item 4 – Problem Statement"],["California State Water Resources Control Board (SWRCB). n.d (a). State Intervention – The State Back Stop, Sustainable Groundwater Management Act (SGMA"],["California State Water Resources Control Board (SWRCB). n.d (b). What is a Public Water System?"],["Caltrans Adjusted County Boundaries shapefile"],null,["California National Highway System shapefile"],null,["Field-scale monitoring of the long-term impact and sustainability of drainage water reuse on the west side of California’s San Joaquin Valley"],["Subsurface geology of the Late Tertiary and Quarternary water-bearing deposits of the southern part of the"],null,["Ground-water conditions in the Mendota- Huron Area Fresno and Kings Counties, California"],["Ground water conditions and storage capacity in the San Joaquin Valley, California"],["Use of ground-water reservoirs for storage of surface water in the San Joaquin Valley California"],["East Stanislaus Regional Water Management Group","East Stanislaus Region Integrated Regional"],["Water Management Plan Update – Public Draft"],null,["Jet Propulsion Laboratory"],null,["Region 4, Central Valley and Pacific Coast Ranges"],["Groundwater availability of the Central Valley Aquifer, California"],["Development of a three-dimensional model of sedimentary texture in valley-fill deposits of Central Valley"],["Water availability and land subsidence in the Central Valley"],["Calculation of a water budget and delineation of contributing sources to drainflows in the Western San Joaquin Valley, California"],["Stratigraphy of the West Side Southern San Joaquin Valley"],["San Joaquin Valley, California—Largest human alteration of the Earth’s surface"],["Land subsidence in the United States"],["Generalized subsurface geology of water-bearing deposits"],null,["hydrology, and water quality of the Tracy-Dos Palo area"],["Land subsidence in the San Joaquin Valley, California, as of 1983"],["Land subsidence in the San Joaquin Valley, California, as of 1980"],["On the flow of water in an elastic artesian aquifer"],["Geological Atlas of California"],["California Geological Survey, Geologic Atlas of California Map"],["Ground water in the San Joaquin Valley, California"],["State of California Well Completion Report"]],[["California Data Exchange Center"],null,null,["California’s Groundwater Bulletin"],["California’s Groundwater Bulletin"],["California Department of Water Resources (DWR"],null,null,null,["Journal of applied meteorology"],["United States Geological Survey"],null,["Journal of Irrigation and Drainage Engineering"],null,null,null,null,null,["United State Bureau of Reclamation (NRDC"],["J. Integr. Agric"],null,null,null,null,null,["Inc"],["United States Bureau of Reclamation (USBR"],null,null,null,null,["USGS WaterSupply Paper 2348"],null,["U.S. Geological Survey Professional Paper 1401-A"],null,null,null,null,null,null,null,["Department of Water Resources Bulletin No.127"],null,["California Well Standards"],null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,["Journal of Environmental Monitoring"],null,null,["U.S. Geological Survey Water Supply Paper"],["U.S. Geological Survey Water Supply Paper"],["U.S. Geological Survey Water-Supply Paper 1618"],null,null,null,null,null,["Hydrogeology: Boulder, Colorado, Geological Society of America, Geology of North America"],["U.S. Geological Survey Professional Paper 1766"],["Hydrogeology Journal"],null,null,null,["Land Subsidence in the United States: U.S. Geological Survey Circular 1182"],["U.S. Geological Survey Circular"],null,null,null,["U.S. Geological Survey Water Resources Investigations Report"],["U.S. Geological Survey Professional Paper"],["American Geophysical Union Trans., pt"],null,null,["U.S. Geological Survey Water-Supply Paper"],null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>author<\/th>\n      <th>date<\/th>\n      <th>title<\/th>\n      <th>container-title<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>It is noticeable above that the data provided by Anystyle has its
challenges for further analysis. The first is a related to data
structure: authors are nested into matrices, some rows (such as the
date) have multiple listed values, etc., all of which make the data hard
to analyze. For example, here is what seems to be two probable citations
combined into one observation:</p>
<pre class="r"><code>unnest(dt[204, c(2,3)])</code></pre>
<pre><code>## # A tibble: 3 × 2
##   date  title                                                                                
##   &lt;chr&gt; &lt;chr&gt;                                                                                
## 1 2017  Long‐Term Socio‐Economic Forecasts by County: Kings County                           
## 2 2015  Progress Report: Subsidence in the Central Valley, California. For Department of Wat…
## 3 2009  Ground‐water availability in California’s Central Valley</code></pre>
<p>The second challenge is related to quality: many of the probable
citations are not sensible. The Anystyle software seems sensitive to
multiple formats like numbers and short-form sentences, such as
addresses, resulting in false positive identification of references. For
example, here is an address listed as a probable citation from our
data:</p>
<pre class="r"><code>unlist(dt[148, c(1,3,5)])</code></pre>
<pre><code>##                                                                                      author.family 
##                                                                                             &quot;When&quot; 
##                                                                                       author.given 
##                                                                                        &quot;Firebaugh&quot; 
##                                                                                              title 
## &quot;5:00 - 7:00 PM Firebaugh Middle School MPR 1600 16th Street, Firebaugh, CA Los Banos – Wednesday&quot; 
##                                                                                   container-title1 
##                                                    &quot;PM College Greens Building 1815 Scripps Drive&quot; 
##                                                                                   container-title2 
##                                                &quot;PM Hammon Senior Center 1033 W. Las Palmas Avenue&quot; 
##                                                                                   container-title3 
##                                                                                           &quot;Monday&quot;</code></pre>
</div>
<div id="reference_clean" class="section level4">
<h4><code>reference_clean()</code></h4>
<p>To try to address the challenges in these probable citations, the
<code>reference_clean()</code> function goes through a series of steps.
For each column the function unlists the data and filters out unlikely
candidates for that column. For instance, if a number listed in the date
column does not match any reasonable date format or expectation, it is
removed. If a string in the URL column actually resembles a DOI, it is
moved to that column. And so on. Furthermore, if there seem to be
multiple citations listed in one row that can be broken apart in
parallel across all of the columns, we unnest these rows. (Note:
depending on the size of the files this function may take some time.
Cleaning these 26528 citations takes about 18 minutes).</p>
<pre class="r"><code># Unnests list structures into tabular data and filters out low probability refs
dt &lt;- reference_clean(dt)</code></pre>
<p>This cleaning process has changed probable citations now a bit. Some
of the probable citations have been unnested (and therefore expanded)
while others have been removed, leaving us with 14423 probable
citations. Examples of these probable citations are below:</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-85b703c43f72e74c7e38" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-85b703c43f72e74c7e38">{"x":{"filter":"none","vertical":false,"data":[["Ayers, RS; Westcot, DW",null,null,null,null,"California Department of Water Resources","California Department of Water Resources",null,null,"Daly, C; Neilson, RP; Phillips, DL","Davis, GH; Green, JH; Olmsted, FH; Brown, DW","Sink; Hargreaves, GH; Samani, ZA","Hopkins, J; B, Anderson","Schmidt, Kenneth D; Associates","MacGillivray, NA","Madera County","Madera County",null,"Hayes, S; Eching, S","Page, RW","Provost; Group, Pritchard Consulting","Program, San Joaquin River Restoration",null,"Program, San Joaquin River Restoration","State Water Resources Control Board","USEnvironmental Protection Agency","USGS","Williamson, AK; Prudic, DE; Swain, LA","AECOM","Belitz, K; Heimes, FJ","Bertoldi, GL; Johnston, RH; Evenson, KD",null,"Borchers, JW; Carpenter, M","Assembly, California",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"California State Water Resources Control Board",null,null,"Caltrans",null,"Caltrans",null,"Corwin, DL","Croft, MG","Davis, GH; Poland, JF","Davis, GH; Green, JH; Olmstead, SH; Brown, DW","Davis, GH; Lofgren, BE; Mack, S",null,null,"Farr, Tom G; Jones, Cathleen E; Lieu, Zhen",null,"Farrar, CD; Bertoldi, GL","Faunt, C; Hanson, RT; Belitz, K; Schmid, W; Predmore, S; Rewis, DL; McPherson, K","Faunt, CC; Belitz, K; Hanson, RT; Survey, Geological","Faunt, CC; Sneed, M; Traum, J; Brandt, JT","Fio, JL","Foss, FD; Blaisdell, R","Galloway, DL; Riley, FS","Galloway, DL; Jones, DR; Ingebritsen, SE","Hotchkiss, WR","Hotchkiss, WR; Balding, GO","Ireland, RL","RL, Ireland; Poland, JF; Riley, FS","Jacob, CE","Jennings, CW; Strand, RG","Mendenhall, WC; Dole, RB; Stabler, H","Luhdorff; Engineers, Scalmanini Consulting","Luhdorff; Engineers, Scalmanini Consulting; Engineering, Davids; Associates, Larry Walker","Luhdorff; Engineers, Scalmanini Consulting","Madera Regional Water Management Group","McBain; Trush, Inc","Mosley, J","National Resources Conservation Service",null,"Ogden, GR","Page, RW",null,"Poland, JF; Lofgren, BE; Ireland, RL; Pugh, AG","Rohde, MM; Matsumoto, S; Howard, J; Liu, S; Riege, L; Remson, EJ"],["1985","2003",null,"1981","1991","2016","2017","1949","2019","1994","1959","1982","2016","2013","1989","1995","2019","2002","2013","1973","2017","2014","2019",null,"2018","2006",null,"1989","2011","1990","1991",null,"2014","2014",null,"2013",null,"2016","1965","1981",null,"1998","2003",null,"2017",null,"2017",null,"2018","2018","2017","2018","2018","2019","2018",null,"2011",null,null,"2017",null,"2018",null,"2012","1972","1957","1959","1964","2017","2018","2017",null,"1988","2009","2010","2015","1994","1968","1999","1999","1972","1971","1986","1984","1940","1958","1916","2011","2015","2016","2014","2002","2017","2009",null,"1988","1973",null,"1975","2018"],["Water Quality for Agriculture FAO 29 Food and Agriculture Organization of the United Nations","Californias Groundwater Bulletin",null,"California Water Well Standards","California Water Well Standards Supplement to Bulletin 7481","Monitoring Networks and Identification of Data Gaps BMP Monitoring Protocols Standards and Sites BMP","Draft Sustainable Management Criteria Best Management Practices SGMA Data Viewer for Land Subsidence","California Open Data Portal NASA JPL InSAR Subsidence Data",null,"A Statisticaltopographic Model for Mapping Climatological Precipitation over Mountainous Terrain","GroundWater Conditions and Storage Capacity in the San Joaquin Valley California","Estimating Potential Evapotranspiration",null,null,"Effective Precipitation a Field Study to Assess Consumptive Use of Winter Rains by Spring and Summer Crops",null,null,"San Joaquin River Restoration Settlement","California Simulation of Evapotranspiration of Applied Water and Agricultural Energy Use in California","Base of Fresh Groundwater Approximately 3000 Micromhos in the San Joaquin Valley California",null,"Seepage Management Plan httpwwwrestoresjrnetwpcontentuploads201802SMP_Draft_September_2014pdf San Joaquin River Restoration Program SJRRP Channel Capacity Report 2018 Restoration Year Httpwwwrestoresjrnetrestorationflowsleveestabilitychannelcapacity San Joaquin River Restoration Program Website",null,"Water Quality","Otices2018t032962_apppdf Tetra Tech San Joaquin River and Bypass System 1d Steady State HECRAS Model Documentation","Guidance on Systematic Planning Using the Data Quality Objectives Process Upper San Joaquin River Basin Storage Investigation Contract Between the United Stated of America and the Newhall Land and Farming Company for Groundwater Pumping","Land Subsidence in California",null,null,"Character and Evolution of GroundWater Flow System in the Central Part of the Western San Joaquin Valley California","Ground Water in the","A Summary Report","Land Subsidence from Groundwater Use in California","Assembly Bill No Water Quality Supply and Infrastructure Improvements Act of 2014",null,"California Lakes Shapefile",null,"California Streams Shapefile","San Joaquin Valley Drainage Investigation San Joaquin Master Drain","Water Well Standards State of California Bulletin 7481",null,"The California Water Plan Update","Californias Groundwater Bulletin 118 Update 2003",null,"California Aqueduct Subsidence Study",null,"DRAFT Best Management Practices for the","Sustainable Management of Groundwater Sustainable Management Criteria BMP","Evaluation of the Effect of Subsidence on Flow Capacity in the Chowchilla and Eastside Bypasses and Reach 4a of the","Water Data Library Database",null,"Economically Distressed Areas Mapping Tool","Natural Communities Commonly Associated with Groundwater NCCAG Dataset","CA Bulletin 118 Groundwater Basins Shapefile","NASA JPL InSAR Subsidence Data",null,"CVSALTS Lower San Joaquin River Committee April 28 2011 Meeting Materials Agenda Item 4 Problem Statement",null,null,null,null,"California National Highway System Shapefile",null,"Fieldscale Monitoring of the Longterm Impact and Sustainability of Drainage Water Reuse on the West Side of Californias San Joaquin Valley","Subsurface Geology of the Late Tertiary and Quarternary Waterbearing Deposits of the Southern Part of the","Groundwater Conditions in the Mendota Huron Area Fresno and Kings Counties California","Ground Water Conditions and Storage Capacity in the San Joaquin Valley California","Use of Groundwater Reservoirs for Storage of Surface Water in the San Joaquin Valley California","East Stanislaus Region Integrated Regional","Water Management Plan Update Public Draft",null,null,"Region 4 Central Valley and Pacific Coast Ranges","Groundwater Availability of the Central Valley Aquifer California","Development of a Threedimensional Model of Sedimentary Texture in Valleyfill Deposits of Central Valley","Water Availability and Land Subsidence in the Central Valley","Calculation of a Water Budget and Delineation of Contributing Sources to Drainflows in the Western San Joaquin Valley California","Stratigraphy of the West Side Southern San Joaquin Valley","San Joaquin Valley CaliforniaLargest Human Alteration of the Earths Surface","Land Subsidence in the United States","Generalized Subsurface Geology of Waterbearing Deposits","Hydrology and Water Quality of the TracyDos Palo Area","Land Subsidence in the San Joaquin Valley California as of 1983","Land Subsidence in the San Joaquin Valley California as of 1980","On the Flow of Water in an Elastic Artesian Aquifer","Geological Atlas of California","Ground Water in the San Joaquin Valley California","State of California Well Completion Report","Western San Joaquin River Watershed Groundwater Quality Assessment Report","Grassland Drainage Area Groundwater Quality Assessment Report","Madera Integrated Regional Water Management Plan Final Draft",null,null,null,null,"Agricultural Land Use and Wildlife in the San Joaquin Valley 17691930 an Overview","Base of Fresh Groundwater Approximately 2000 Micromhos in the San Joaquin Valley",null,"Land Subsidence in the San Joaquin Valley California as of 1972 US","Groundwater Dependent Ecosystems under the Sustainable Groundwater Management Act Guidance for Preparing Groundwater Sustainability Plans"],["California Data Exchange Center",null,null,"Californias Groundwater Bulletin","Californias Groundwater Bulletin","California Department of Water Resources DWR",null,null,null,"Journal of Applied Meteorology","United States Geological Survey","Journal of Irrigation and Drainage Engineering",null,null,null,null,null,"United State Bureau of Reclamation NRDC","J Integr Agric",null,null,null,null,null,"Inc","United States Bureau of Reclamation USBR",null,null,null,"USGS WaterSupply Paper 2348",null,"US Geological Survey Professional Paper 1401a",null,null,null,null,null,null,"Department of Water Resources Bulletin No127",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"Journal of Environmental Monitoring",null,"US Geological Survey Water Supply Paper","US Geological Survey Water Supply Paper","US Geological Survey WaterSupply Paper 1618",null,null,null,null,"Hydrogeology Boulder Colorado Geological Society of America Geology of North America","US Geological Survey Professional Paper 1766","Hydrogeology Journal",null,null,null,"Land Subsidence in the United States US Geological Survey Circular 1182","US Geological Survey Circular",null,null,"US Geological Survey Water Resources Investigations Report","US Geological Survey Professional Paper","American Geophysical Union Trans Pt",null,"US Geological Survey WaterSupply Paper",null,null,null,null,null,null,null,null,"SOLO Heritage Research San Joaquin Valley Drainage Program US Department of Interior",null,null,"Geological Survey Professional Paper",null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>author<\/th>\n      <th>year<\/th>\n      <th>title<\/th>\n      <th>container<\/th>\n      <th>publisher<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="referenceclassify" class="section level3">
<h3><code>referenceClassify</code></h3>
<p>The <code>referenceClassify</code> package is designed to take a data
frame of tabular, tagged citation data (author, year, container,
publisher, doi, etc), look for exact matches between those tags and
various high-level indices (mainly journal and agency names), and begin
to classify probable citations into these high-level categories. These
indices are 1:) an index of academic journals from the <a
href="https://rdrr.io/github/ikashnitsky/sjrdata/man/sjr_journals.html"><code>sjr</code>
package</a> relying on the <a href="https://www.scimagojr.com/">Scimago
database</a>, 2) an index of academic conference papers/proceedings also
from the Scimago database, 3) and an index of US state and federal
agencies, curated by the package authors. All three of these indices are
built into this package and can be accessed with
<code>data(scimago.j)</code> for journals, <code>data(scimago.c)</code>
for conferences, and <code>data(agencies)</code> for agencies.</p>
<!---
#### `_match()` functions  

Based on our initial cleaning of the GSP data in the previous section, we can see which of these probable citations are exact matches to three different indices: an index of academic journals from the Scimago database, an index of academic conference papers/proceedings also from the Scimago database, and an index of US state and federal agencies, curated by the package authors. We can look for matches using the `journal_match()`, `conference_match()` and `agency_match()` functions.


```r
table(journal_match(dt$container))
```

```
## 
## FALSE  TRUE 
## 13543   880
```


```r
table(conference_match(dt$container))
```

```
## 
## FALSE  TRUE 
## 14420     3
```


```r
table(agency_match(dt$container, dt$author))
```

```
## 
## FALSE  TRUE 
## 13967   456
```
--->
<div id="prepared_by-and-journal_disambig" class="section level4">
<h4><code>prepared_by()</code> and <code>journal_disambig()</code></h4>
<p>[<strong>Note: Should these be moved to the cleaning function, or to
the other package?</strong>]</p>
<p>Before classifying our probable references, we can further clean and
refine these potential citations with the <code>prepared_by()</code>
function, which removes commonly-seen lead-ins to references (‘prepared
for/by’, etc.) to improve exact matching.</p>
<pre class="r"><code>dt &lt;- prepared_by(dt, x = &#39;container&#39;, y = &#39;author&#39;, z = &#39;publisher&#39;)</code></pre>
<p>Additionally, we disambiguate the journals with the
<code>journal_disambig()</code> function, which references indices of
common journal abbreviations and through manual cleaning of journals
referenced in transportation documents.</p>
<pre class="r"><code>dt$container &lt;- journal_disambig(dt$container)</code></pre>
</div>
<div id="regex_classify" class="section level4">
<h4><code>regex_classify()</code></h4>
<p>Now with probable references as ‘clean’ as possible, we use regular
expressions to classify our data based on exact matches using the
<code>regex_classify()</code> function. This function does two things.
First it looks across all of the columns for exact matches to our
indices, and if there is an exact match, it pulls out that value into a
‘input’ column. If there is no exact match, the value in the input
column will be selected in the following order of preference: doi,
container, publisher, title, author. Second, based on the matches the
function will assign the potential citation into one of four classes:
journal, agency, conference, or none. If none of the potential
citations’ data is an exact match to any of the indices, the
classification is NA.</p>
<pre class="r"><code># Extract most descriptive &#39;input&#39; and look for exact match to index 
dt &lt;- regex_classify(dt, &#39;container&#39;)</code></pre>
<p>Based on these classifications, we can see the counts of exact
matches, and which ones have not been classified.</p>
<table>
<thead>
<tr>
<th style="text-align:right;">
Agency
</th>
<th style="text-align:right;">
Conference
</th>
<th style="text-align:right;">
Journal
</th>
<th style="text-align:right;">
Not a citation
</th>
<th style="text-align:right;">
Unclassified
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1867
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
997
</td>
<td style="text-align:right;">
146
</td>
<td style="text-align:right;">
10899
</td>
</tr>
</tbody>
</table>
</div>
<div id="keras_classify" class="section level4">
<h4><code>keras_classify()</code></h4>
<p>Next we want to classify the probable references that are not exact
matches to any of our indices. To do this, we use
<code>keras_classify()</code> input our probable into a neural network
trained to predict the reference class. To train this model, we used
data from Environmental Impact Statements, classified through both
manual classification and the semi-automated regex classification
explained above.</p>
<pre class="r"><code># Use the descriptive &#39;input&#39; to probabilistically identify the reference class
## Note: Need to set this wd right now because I can&#39;t actually get the model object to save within the package itself
setwd(&quot;~/Documents/Davis/R-Projects/referenceClassify/&quot;)
# Something is wrong with the auto_input
predictions &lt;- keras_classify(dt, probability = .85, 
                              &#39;container&#39;, auto_input = F,
                              &#39;training_input&#39;) 
dt &lt;- cbind(dt, select(predictions, predict_class))</code></pre>
<p>Because we ran this model on the whole data frame, we can compare our
regex classification with the Keras classifications to get a sense of
the model performance.</p>
<table>
<thead>
<tr>
<th style="text-align:right;">
Incorrect
</th>
<th style="text-align:right;">
Match
</th>
<th style="text-align:right;">
Classified as unsure
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
2801
</td>
<td style="text-align:right;">
182
</td>
</tr>
</tbody>
</table>
<p>These results, altogether, suggest that the Keras model is 93%
accurate in its prediction of the citations we are able to do exact
matching for. Now, let’s unify the classification columns and have a
look at the total for each estimated grouping.</p>
<table>
<thead>
<tr>
<th style="text-align:right;">
Agency
</th>
<th style="text-align:right;">
Conference
</th>
<th style="text-align:right;">
Not a citation
</th>
<th style="text-align:right;">
Journal
</th>
<th style="text-align:right;">
Unsure
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
3675
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
3163
</td>
<td style="text-align:right;">
1856
</td>
<td style="text-align:right;">
5213
</td>
</tr>
</tbody>
</table>
<p>And we’ll tidy up these data by filtering out the citations
classificied to ‘delete’ (the false positives) in preparation for our
indexing in the next step.</p>
<pre class="r"><code>dt &lt;- dt %&gt;% 
  select(-c(predict_class, method_comparison)) %&gt;% 
  filter(class != &quot;delete&quot;)</code></pre>
</div>
<div id="interim-check-in-journals-and-agencies-from-exact-matching"
class="section level4">
<h4>Interim check in: Journals and agencies from exact matching</h4>
<p>So far, we’ve identified exact matches to our high-level indices
(journal, agency, conference) and then used machine learning to classify
citations that are not exact matches so that we can begin to figure out
their source. At this interim stage, we can take a look at the
high-level classifications across citations, and the journals and
agencies for which we’ve found exact matches.</p>
<p>First, let’s take a look at the high-level matches. A reference list
was required by DWR for GSPs, and indeed we see that all 114 of the
documents have references that we can identify as either a scholarly
journal or agency. Based on our tool’s probabilistic tags, it looks like
the number of references ranges from 1 to 128, with 24 being the average
number of classified references. That average differs between references
classes, whereby the average number of journal references is 16 and the
average number of agency references is twice that, at 32.</p>
<p>Below are the top 15 references journals and agencies identified by
our exact matching strategies.</p>
<p>[<strong>Note: I need to exact match agency</strong>]</p>
<pre class="r"><code>cowplot::plot_grid(p_jour, p_agency, rel_widths = c(1, 1))</code></pre>
<p><img src="gsp_vignette_files/figure-html/unnamed-chunk-10-1.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="indexbuild" class="section level3">
<h3><code>indexBuild</code></h3>
<p>Now that we have a general sense of what kind of citation types are
represented within the probable citations, the next step is to try to
index these citations exactly.</p>
<div id="identify-index-concepts" class="section level4">
<h4>Identify index concepts</h4>
<p>First we need to generate an index. The indexBuild function wraps
around the OpenAlex API</p>
<p>First, what are the areas we already have known references from? We
koad in the Scimago database, including journal metdata, to get an
understanding of what journals can be identified through exact
matching.</p>
<pre class="r"><code>themes &lt;- dt_journals %&gt;% 
  select(sourceid, journal_title, cat1:cat15) %&gt;% 
  pivot_longer(cols = cat1:cat15, 
               names_to = &quot;number&quot;,
               values_to = &quot;cat&quot;) %&gt;% 
  filter(!is.na(cat)) %&gt;% 
  mutate(cat = trimws(str_remove_all(cat, &#39;\\(Q\\d\\)&#39;))) %&gt;% 
  mutate(cat = trimws(str_remove_all(tolower(cat),
                                     &#39;\\(miscellaneous\\)|,|-&#39;))) %&gt;% 
  group_by(cat) %&gt;% 
  count() %&gt;% 
  arrange(n) %&gt;% 
  mutate(cat = factor(cat, levels = .$cat))</code></pre>
<p><img src="gsp_vignette_files/figure-html/unnamed-chunk-13-1.png" width="480" style="display: block; margin: auto;" /></p>
<pre class="r"><code>keywords &lt;- tidytext::unnest_tokens(themes, word, cat) %&gt;% 
  dplyr::filter(!word %in% tidytext::stop_words$word) %&gt;% 
  mutate(word = textstem::lemmatize_words(word)) %&gt;% 
  unique()</code></pre>
<p>Let’s use these themes and keywords to inform our index creation. I
build in a quick bit of sleep time for querying the concepts from
openAlex, then apply this functions across all of the themes and
keywords existing in the data. (Note: This querying of over 200 concepts
takes ~5 minutes.)</p>
</div>
<div id="queryconcepts" class="section level4">
<h4><code>queryConcepts()</code></h4>
<pre class="r"><code>query_slowly &lt;- function(x){
  index &lt;- queryConcepts(concept_string = x, 
                         per_page = 50)
  return(index)
  Sys.sleep(1)
}
index &lt;- lapply(c(themes$cat, keywords$word), query_slowly)
# For whatever reason there was no description column for 7
index[[12]]$description &lt;- &quot;&quot;
indexdf &lt;- do.call(&#39;rbind&#39;, index) %&gt;% unique()</code></pre>
<p>Now we have a number of resources representing the concepts from our
existing data. Here is a random look at some of them.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-7f0009f251a517c37158" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7f0009f251a517c37158">{"x":{"filter":"none","vertical":false,"data":[["https://openalex.org/C2780748813","https://openalex.org/C2780367213","https://openalex.org/C48406656","https://openalex.org/C3019557281","https://openalex.org/C119887631","https://openalex.org/C154615088","https://openalex.org/C93907247","https://openalex.org/C2777413408","https://openalex.org/C82576440","https://openalex.org/C85363599","https://openalex.org/C155164915","https://openalex.org/C2781302328","https://openalex.org/C2992826032","https://openalex.org/C2777226563","https://openalex.org/C513891491","https://openalex.org/C56685638","https://openalex.org/C115240124","https://openalex.org/C163926583","https://openalex.org/C174378899","https://openalex.org/C2777362769","https://openalex.org/C2988134249","https://openalex.org/C111429119","https://openalex.org/C2985119592","https://openalex.org/C2779915747","https://openalex.org/C2987381348","https://openalex.org/C4384302","https://openalex.org/C26057338","https://openalex.org/C135009316","https://openalex.org/C2986265897","https://openalex.org/C115343472","https://openalex.org/C2982889124","https://openalex.org/C177877439","https://openalex.org/C167310288","https://openalex.org/C2777380357","https://openalex.org/C85641259","https://openalex.org/C84597430","https://openalex.org/C117959457","https://openalex.org/C45613198","https://openalex.org/C98045186","https://openalex.org/C2779627474","https://openalex.org/C28901747","https://openalex.org/C32896092","https://openalex.org/C54757728","https://openalex.org/C2778054127","https://openalex.org/C149441793","https://openalex.org/C2986080485","https://openalex.org/C105592727","https://openalex.org/C109260823","https://openalex.org/C506295513","https://openalex.org/C94361409","https://openalex.org/C58312451","https://openalex.org/C2992416070","https://openalex.org/C2776838516","https://openalex.org/C175601593","https://openalex.org/C2778195246","https://openalex.org/C167966045","https://openalex.org/C548081761","https://openalex.org/C41525213","https://openalex.org/C2776776657","https://openalex.org/C63504599","https://openalex.org/C96175551","https://openalex.org/C136676167","https://openalex.org/C2777896290","https://openalex.org/C32239851","https://openalex.org/C2982902064","https://openalex.org/C2778395451","https://openalex.org/C48256821","https://openalex.org/C2911045874","https://openalex.org/C123676819","https://openalex.org/C99747519","https://openalex.org/C2777280699","https://openalex.org/C104727253","https://openalex.org/C2776719154","https://openalex.org/C165525559","https://openalex.org/C22787982","https://openalex.org/C49892992","https://openalex.org/C2779473921","https://openalex.org/C39214371","https://openalex.org/C2775974668","https://openalex.org/C42023084","https://openalex.org/C2778736646","https://openalex.org/C98208228","https://openalex.org/C6582778","https://openalex.org/C179737136","https://openalex.org/C2779764123","https://openalex.org/C114990195","https://openalex.org/C2993426478","https://openalex.org/C2779242930","https://openalex.org/C154718420","https://openalex.org/C553184892","https://openalex.org/C74275925","https://openalex.org/C53706860","https://openalex.org/C2780033181","https://openalex.org/C76471051","https://openalex.org/C2776188440","https://openalex.org/C2777022838","https://openalex.org/C66279824","https://openalex.org/C19843653"],["Sustainable management","Agricultural biotechnology","Martingale (probability theory)","Biomass fuels","Complex fluid","Genetically modified maize","Geotechnics","Optical tomography","Fuel oil","Contemporary art","Health psychology","Scan statistic","Public discourse","Animal-assisted therapy","Civil society","Power control","Earth remote sensing","High-energy astronomy","Sustainable community","Computer program","Deep water","Chemical shift","Plasma chemistry","Inverse probability weighting","Electronic records","Statistical population","Fermi energy","Colored dissolved organic matter","Human physiology","Global warming","Disease management","Statistical relational learning","Sound quality","Rainfed agriculture","Turn (biochemistry)","Locus (genetics)","Biological anthropology","Optical filter","Process (computing)","Structural adjustment","Decision theory","Risk management","Nuclear export signal","Ecological crisis","Probability distribution","Decision maker","Integrated geography","Child development","Economic integration","Uncertainty reduction theory","Atom (system on chip)","Electronic library","Genetic algorithm","Magnetic structure","Physical dependence","Generative model","Waste management","Electronic data interchange","Aviation fuel","Economic globalization","Fractal landscape","Surface plasmon","Nuclear membrane","Trough (economics)","Library automation","Occupational segregation","Electrolysis of water","Gold Colloid","Perfect information","Civil discourse","Continuing medical education","Biological pest control","Downside risk","Homology (biology)","Urban ecology","Tissue engineering","Inorganic polymer","Organizational behavior","Nature of Science","Decision boundary","Software suite","United States regulation of point source water pollution","North Atlantic Deep Water","Design technology","Wasting","Effects of global warming","Agricultural waste","Global temperature","Wind profile power law","Flow cytometry","Management accounting","Soil morphology","Decision aids","House of Quality","Follicular fluid","Maximum sustainable yield","Planetary migration","Model organism"],[3,3,2,3,2,5,2,3,2,3,3,2,3,4,3,3,3,3,3,2,2,2,3,3,2,3,3,4,2,3,4,3,2,3,2,3,2,2,2,2,2,2,4,2,2,2,5,2,2,2,2,4,2,4,3,3,1,2,2,3,5,3,3,2,2,3,5,4,2,3,3,2,3,3,3,2,3,2,3,3,3,4,3,2,2,4,2,4,3,2,2,4,3,5,4,4,4,3],[5461,4084,14594,1385,2467,3876,1712,5255,13555,13469,33973,1374,4477,7985,61903,33543,388,1809,1851,16499,12150,26703,2104,1731,2401,3801,8580,3780,17499,80930,18021,2397,6445,2530,27474,137685,5061,22754,2603891,3855,9793,122346,6712,3456,49818,13258,154,23015,24114,1017,157358,2245,28019,9368,2839,16632,1963695,2388,1009,9440,1430,43022,2509,24736,4367,1394,6474,991,5726,1614,12026,82814,4619,59924,4377,76653,439,12366,3408,1874,1242,737,7268,4809,18422,6769,2419,1956,7271,185440,25140,2960,4403,2282,8057,1426,3397,13902],["https://api.openalex.org/works?filter=concepts.id:C2780748813","https://api.openalex.org/works?filter=concepts.id:C2780367213","https://api.openalex.org/works?filter=concepts.id:C48406656","https://api.openalex.org/works?filter=concepts.id:C3019557281","https://api.openalex.org/works?filter=concepts.id:C119887631","https://api.openalex.org/works?filter=concepts.id:C154615088","https://api.openalex.org/works?filter=concepts.id:C93907247","https://api.openalex.org/works?filter=concepts.id:C2777413408","https://api.openalex.org/works?filter=concepts.id:C82576440","https://api.openalex.org/works?filter=concepts.id:C85363599","https://api.openalex.org/works?filter=concepts.id:C155164915","https://api.openalex.org/works?filter=concepts.id:C2781302328","https://api.openalex.org/works?filter=concepts.id:C2992826032","https://api.openalex.org/works?filter=concepts.id:C2777226563","https://api.openalex.org/works?filter=concepts.id:C513891491","https://api.openalex.org/works?filter=concepts.id:C56685638","https://api.openalex.org/works?filter=concepts.id:C115240124","https://api.openalex.org/works?filter=concepts.id:C163926583","https://api.openalex.org/works?filter=concepts.id:C174378899","https://api.openalex.org/works?filter=concepts.id:C2777362769","https://api.openalex.org/works?filter=concepts.id:C2988134249","https://api.openalex.org/works?filter=concepts.id:C111429119","https://api.openalex.org/works?filter=concepts.id:C2985119592","https://api.openalex.org/works?filter=concepts.id:C2779915747","https://api.openalex.org/works?filter=concepts.id:C2987381348","https://api.openalex.org/works?filter=concepts.id:C4384302","https://api.openalex.org/works?filter=concepts.id:C26057338","https://api.openalex.org/works?filter=concepts.id:C135009316","https://api.openalex.org/works?filter=concepts.id:C2986265897","https://api.openalex.org/works?filter=concepts.id:C115343472","https://api.openalex.org/works?filter=concepts.id:C2982889124","https://api.openalex.org/works?filter=concepts.id:C177877439","https://api.openalex.org/works?filter=concepts.id:C167310288","https://api.openalex.org/works?filter=concepts.id:C2777380357","https://api.openalex.org/works?filter=concepts.id:C85641259","https://api.openalex.org/works?filter=concepts.id:C84597430","https://api.openalex.org/works?filter=concepts.id:C117959457","https://api.openalex.org/works?filter=concepts.id:C45613198","https://api.openalex.org/works?filter=concepts.id:C98045186","https://api.openalex.org/works?filter=concepts.id:C2779627474","https://api.openalex.org/works?filter=concepts.id:C28901747","https://api.openalex.org/works?filter=concepts.id:C32896092","https://api.openalex.org/works?filter=concepts.id:C54757728","https://api.openalex.org/works?filter=concepts.id:C2778054127","https://api.openalex.org/works?filter=concepts.id:C149441793","https://api.openalex.org/works?filter=concepts.id:C2986080485","https://api.openalex.org/works?filter=concepts.id:C105592727","https://api.openalex.org/works?filter=concepts.id:C109260823","https://api.openalex.org/works?filter=concepts.id:C506295513","https://api.openalex.org/works?filter=concepts.id:C94361409","https://api.openalex.org/works?filter=concepts.id:C58312451","https://api.openalex.org/works?filter=concepts.id:C2992416070","https://api.openalex.org/works?filter=concepts.id:C2776838516","https://api.openalex.org/works?filter=concepts.id:C175601593","https://api.openalex.org/works?filter=concepts.id:C2778195246","https://api.openalex.org/works?filter=concepts.id:C167966045","https://api.openalex.org/works?filter=concepts.id:C548081761","https://api.openalex.org/works?filter=concepts.id:C41525213","https://api.openalex.org/works?filter=concepts.id:C2776776657","https://api.openalex.org/works?filter=concepts.id:C63504599","https://api.openalex.org/works?filter=concepts.id:C96175551","https://api.openalex.org/works?filter=concepts.id:C136676167","https://api.openalex.org/works?filter=concepts.id:C2777896290","https://api.openalex.org/works?filter=concepts.id:C32239851","https://api.openalex.org/works?filter=concepts.id:C2982902064","https://api.openalex.org/works?filter=concepts.id:C2778395451","https://api.openalex.org/works?filter=concepts.id:C48256821","https://api.openalex.org/works?filter=concepts.id:C2911045874","https://api.openalex.org/works?filter=concepts.id:C123676819","https://api.openalex.org/works?filter=concepts.id:C99747519","https://api.openalex.org/works?filter=concepts.id:C2777280699","https://api.openalex.org/works?filter=concepts.id:C104727253","https://api.openalex.org/works?filter=concepts.id:C2776719154","https://api.openalex.org/works?filter=concepts.id:C165525559","https://api.openalex.org/works?filter=concepts.id:C22787982","https://api.openalex.org/works?filter=concepts.id:C49892992","https://api.openalex.org/works?filter=concepts.id:C2779473921","https://api.openalex.org/works?filter=concepts.id:C39214371","https://api.openalex.org/works?filter=concepts.id:C2775974668","https://api.openalex.org/works?filter=concepts.id:C42023084","https://api.openalex.org/works?filter=concepts.id:C2778736646","https://api.openalex.org/works?filter=concepts.id:C98208228","https://api.openalex.org/works?filter=concepts.id:C6582778","https://api.openalex.org/works?filter=concepts.id:C179737136","https://api.openalex.org/works?filter=concepts.id:C2779764123","https://api.openalex.org/works?filter=concepts.id:C114990195","https://api.openalex.org/works?filter=concepts.id:C2993426478","https://api.openalex.org/works?filter=concepts.id:C2779242930","https://api.openalex.org/works?filter=concepts.id:C154718420","https://api.openalex.org/works?filter=concepts.id:C553184892","https://api.openalex.org/works?filter=concepts.id:C74275925","https://api.openalex.org/works?filter=concepts.id:C53706860","https://api.openalex.org/works?filter=concepts.id:C2780033181","https://api.openalex.org/works?filter=concepts.id:C76471051","https://api.openalex.org/works?filter=concepts.id:C2776188440","https://api.openalex.org/works?filter=concepts.id:C2777022838","https://api.openalex.org/works?filter=concepts.id:C66279824","https://api.openalex.org/works?filter=concepts.id:C19843653"],[null,"area of agricultural science","model in probability theory, used in gambling","fuel that is produced through contemporary biological processes, as opposed to fossil fuel that was produced by prehistoric bio-geological processes","mixture that has a coexistence between two phases","genetically modified crop","scientific study of earth materials in engineering problems; branch of civil engineering concerned with the engineering behavior of earth materials",null,"heavy fraction obtained from petroleum distillation that is burned to generate power","art of the present time beginning with Pop Art and Conceptual Art","the study of psychological and behavioral processes in health, illness, and healthcare",null,"area in social life","alternative therapy that involves animals as a form of treatment","the third sector of society, distinct from government and business","automatic control of transmission power in mobile phones","acquisition of information about an object or phenomenon without making physical contact with the object, especially the Earth","study of astronomical objects that release electromagnetic radiation of highly energetic wavelengths",null,"sequence of instructions written in programming language to perform a specified task with a computer","Wikimedia disambiguation page","resonant frequency of a nucleus relative to a standard",null,null,"practice or discipline of controlling and governing what are considered to be the most important records of an organization throughout the records life-cycle","complete set of items that share at least one property in common that is the subject of a statistical analysis","concept in quantum mechanics referring to the energy difference between the highest and lowest occupied single-particle states in a quantum system of non-interacting fermions at absolute zero temperature","optically measurable component of the dissolved organic matter in water","entire structure of a human organism","current rise in Earth's average temperature and related large-scale shifts in weather patterns","topics referred to by the same term","subdiscipline of artificial intelligence","assessment of the audio output from an electronic device",null,"element of secondary structure in proteins where the polypeptide chain reverses its overall direction","location of a gene at a chromosome","branch of anthropology that studies the physical development of the human species","device that selectively transmits light of certain wavelengths","particular execution of a computer program","provision of loans by the International Monetary Fund and World Bank to countries that experienced economic crises","study of an agent's choices","set of measures for the systematic identification, analysis, assessment, monitoring and control of risks",null,"catastrophic event regarding the environment due to human activity","mathematical function that describes the probability of occurrence of different possible outcomes in an experiment","cognitive process resulting in choosing a course of action among several alternative possibilities","branch of geography that describes and explains the spatial aspects of interactions between human individuals or societies and their natural environment","biological, psychological and emotional changes in humans from birth to the end of adolescence","unification of economic policies between different states","postpositivist communication theory that, when interacting, people need information about the other party in order to reduce their uncertainty","System on chip","online database of digital objects stored in electronic media formats and accessible via computers","competitive algorithm for searching a problem space","ordered arrangement of magnetic spins in a material","physical condition caused by chronic use of a tolerance-forming drug",null,"generation, prevention, characterization, monitoring, treatment, handling, reuse and residual disposition of solid wastes","electronic communication method","propellents used to power aircraft or aviation systems","Increasing economic interdependence of national economies across the world","Stochastically generated naturalistic terrain",null,"aka nuclear membrane",null,"software that organizes and provides access to a library collection","the distribution of workers across and within occupations, based upon demographic characteristics, most often gender","decomposition of water into oxygen and hydrogen gas due to the passage of an electric current","suspension of gold particles in another medium","condition in economics and game theory",null,"educational programs to inform physicians of recent advances","method of controlling pests using other living organisms","financial risk associated with losses, actual returns below benchmarks, or results below expectation","existence of shared ancestry between a pair of structures, or genes, in different taxa","area of study in ecology","combination of cells, engineering, and materials methods, and suitable biochemical and physicochemical factors to improve or replace biological tissues","polymer whose structure's backbone does not include carbon (but may have organic substituents)","study of human behavior in organizational settings","branch of philosophy concerned with the foundations, methods, and implications of science","Boundary used within classification","collection of related computer programs",null,"deep water mass formed in the North Atlantic Ocean","study, design, development, application, implementation, support and management of computer and non-computer based technologies for the express purpose of communicating product design intent and constructability","Human disease","describes the effects created by human caused climate change","biodegradable waste","measurements &amp; proxies",null,"technique of suspending cells in a stream of fluid and passing them by an electronic detection apparatus","field of business administration, part of the internal accounting system of a company","field observable attributes of the soil within the various soil horizons and the description of the kind and arrangement of the horizons",null,"Early Stage Product Design and Development  Technique",null,null,"astronomical phenomenon when a planet or other stellar satellite interacts with a disk of gas or planetesimals, resulting in the alteration of the satellite's orbital parameters, especially its semi-major axis","organisms used to study biology across species"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>id<\/th>\n      <th>display_name<\/th>\n      <th>level<\/th>\n      <th>works_count<\/th>\n      <th>works_api_url<\/th>\n      <th>description<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>What we end up is a list of concepts, related to which are different
‘works’, or specific citations. We can extract the works from those
concepts below. I currently break this into two extraction rounds, small
and large, because they need to be handled differently. This extraction
c</p>
</div>
<div id="extractworks" class="section level4">
<h4><code>extractWorks()</code></h4>
<pre class="r"><code>smallworks &lt;- filter(indexdf, works_count &lt; 1000000)

sapply(smallworks$id[i], FUN = function(x){
  extractWorks(mailto = &quot;belwood@ucdavis.edu&quot;,
             concept_page = x,
             dest_file = paste0(&quot;~/Box/govscienceuseR/openalex_index_gsp/&quot;, 
                              stringr::str_extract(x,&#39;[A-Za-z0-9]+$&#39;),
                              &quot;_2000_2020&quot;, &quot;.json.gz&quot;),
             per_page = 200, # must be between 1 and 200
             to_date = 2022,
             from_date = 2000,
             sleep_time = 0.5)

})

# I did it this way so that if it breaks due to internet connection failure I can see where it leaves off
for(i in 125:nrow(smallworks)){
sapply(smallworks$id[i], FUN = function(x){
  extractWorks(mailto = &quot;belwood@ucdavis.edu&quot;,
             concept_page = x,
             dest_file = paste0(&quot;~/Box/govscienceuseR/openalex_index_gsp/&quot;, 
                              stringr::str_extract(x,&#39;[A-Za-z0-9]+$&#39;),
                              &quot;_2000_2020&quot;, &quot;.json.gz&quot;),
             per_page = 200, # must be between 1 and 200
             to_date = 2022,
             from_date = 2000,
             sleep_time = 0.5)

})
}</code></pre>
<pre class="r"><code>largeworks &lt;- filter(indexdf, works_count &gt;= 1000000)

for(i in 1:nrow(largeworks)){
  for(j in 2000:2022){
sapply(largeworks$id[i], FUN = function(x){
  extractWorks(mailto = &quot;belwood@ucdavis.edu&quot;,
             concept_page = x,
             dest_file = paste0(&quot;~/Box/govscienceuseR/openalex_index_gsp/&quot;, 
                              stringr::str_extract(x,&#39;[A-Za-z0-9]+$&#39;),
                              &quot;_&quot;, j, &quot;.json.gz&quot;),
             per_page = 100,
             to_date = j,
             from_date = j,
             sleep_time = 0.5)

})
}
}</code></pre>
</div>
<div id="works2dt" class="section level4">
<h4><code>works2dt()</code></h4>
<pre class="r"><code>jsons &lt;- list.files(&quot;~/Box/govscienceuseR/openalex_index_gsp/&quot;, full.names = T)
# Anything that is 23 is empty
jsons &lt;- jsons[file.size(jsons) &gt; 23]
t1 &lt;- Sys.time()
records &lt;- lapply(jsons, works2dt)
recordsdf &lt;- do.call(&quot;rbind&quot;, records)
t2 &lt;- Sys.time()</code></pre>
<p>We’ve generated quite a wide database, including 1388002 records in
our index. However, this likely leaves out edge cases, and we are
developing ways to develop broader indices.</p>
</div>
</div>
<div id="referencesearch" class="section level3">
<h3><code>referenceSearch</code></h3>
<p>Now we have our probable citations and their groupings, we have an
index to match them to, and now we want to probabilistically match
them.</p>
<p>Let’s isolate our probable citations that would likely map onto our
index of academic reference.</p>
<pre class="r"><code>dt_solr &lt;- dt %&gt;% 
  filter(class == &quot;journal&quot;) %&gt;% 
  select(title, author, year, publisher, container,  
         doi) %&gt;% 
  rename(&quot;journal_title&quot; = container,
         &quot;authors&quot; = author) %&gt;% 
  mutate(year = as.numeric(year))

queries &lt;- create_queries(dt_solr)</code></pre>
<p>This is where you’ll need your Solr instance running In your command
line/terminal, navigate to your solr download, then start a cloud
instance by ..</p>
<pre><code>path/to/solr.9.0.1/bin/solr start -c</code></pre>
<pre class="bash"><code>~/Applications/solr-9.1.0/bin/solr start -c</code></pre>
<pre><code>## *** [WARN] *** Your open file limit is currently 10496.  
##  It should be set to 65000 to avoid operational disruption. 
##  If you no longer wish to see this warning, set SOLR_ULIMIT_CHECKS to false in your profile or solr.in.sh
## *** [WARN] ***  Your Max Processes Limit is currently 2784. 
##  It should be set to 65000 to avoid operational disruption. 
##  If you no longer wish to see this warning, set SOLR_ULIMIT_CHECKS to false in your profile or solr.in.sh
## Waiting up to 180 seconds to see Solr running on port 8983 [|]   [/]   [-]   [\]   [|]   [/]   [-]   [\]   [|]   [/]   [-]   [\]   [|]   [/]   [-]   [\]   [|]  
## Started Solr server on port 8983 (pid=2336). Happy searching!
## 
##     </code></pre>
<pre class="r"><code>#records &lt;- &quot;~/Box/govscienceuseR/openalex_index_gsp/&quot;
colnames(recordsdf)[c(1,2,3,5,7,8,10,12)] &lt;- c(&quot;source&quot;, &quot;title&quot;, &quot;doi&quot;, 
                                               &quot;year&quot;, &quot;miscid&quot;,
                                           &quot;journal_title&quot;,
                                           &quot;publisher&quot;, &quot;authors&quot;)</code></pre>
<pre class="r"><code>index_records(recordsdf, collection_name = &quot;gsp_index&quot;, overwrite = T)</code></pre>
<p>This does not run, I get ” Error: 400 - undefined field year ”</p>
<pre class="r"><code>results &lt;- search_collection(q = queries[3], 
                                   collection_name = &quot;WOS_demo&quot;, 
                                   topn = 3)</code></pre>
<p>Waiting to run then, then</p>
<pre class="r"><code>results = list()
count = 1
for (q in queries[1:10]) {
  res = search_collection(q, collection_name = &quot;gsp_index&quot;)
  res$id = count
  res$q = q
  results[[count]] = res
  count = count + 1
}
results_df = do.call(dplyr::bind_rows, results)</code></pre>
<pre class="bash"><code>~/Applications/solr-9.1.0/bin/solr stop</code></pre>
<pre><code>## Sending stop command to Solr running on port 8983 ... waiting up to 180 seconds to allow Jetty process 2336 to stop gracefully.
##  [|]   [/]   [-]   [\]      </code></pre>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
