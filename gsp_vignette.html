<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>govscienceuseR for Groundwater Sustainable Plans</title>

<script src="site_libs/header-attrs-2.13/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="site_libs/datatables-binding-0.22/datatables.js"></script>
<link href="site_libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="site_libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="site_libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">govscienceuseR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="README.md">Home</a>
</li>
<li>
  <a href="gsp_vignette.html">Vignettes</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">govscienceuseR for Groundwater Sustainable
Plans</h1>

</div>


<pre class="r"><code>knitr::opts_chunk$set(warning = F, message = F)</code></pre>
<div id="introduction" class="section level3">
<h3>Introduction</h3>
<p>Understanding the policy that goes into science is important…
Sarewitz Cairney</p>
<p>However, it can be a tedious task… Koontz looks in depth at 12 plans,
1,104 references across them, but these include all kinds of sources:
scholarly, articles, organizations, agencies at different levels, etc.
Desmaris and Herd (2014) 102 Regulatory Impact Assessments, describing
1,378 scholarly citations, and though recognizing the significant
presence of non-scholarly citations, they do not anylze those</p>
</div>
<div id="method" class="section level3">
<h3>Method</h3>
<p>This is vignette walking through the steps of the packages in the
<code>govscienceuseR</code> tool set: <code>referenceExtract</code>,
<code>referenceClassify</code>, <code>indexBuild</code>, and
<code>referenceSearch</code>. Together, these four packages allow
researchers to go from PDF documents to a data frame of indexed
citations in only a handful of steps. The goal of these tools is to
allow researchers working with various types of policy documents to
analyze citations using a systematic and reproducible approach.</p>
</div>
<div id="the-case" class="section level3">
<h3>The case</h3>
<p>Sustainable Groundwater Management Act… The data we’ll be using are
documents for California’s Groundwater Sustainability Plans. These
documents are Groundwater Sustainability Agency-level plans, developed
in response to the state’s Sustainable Ground Management Act. Passed in
2014, SGMA has required that GSAs (‘Agencies’) develop plans to meeting
various sustainability goals for groundwater, including… As such, these
documents provide a useful case for evaluating the use of science in
policy, as there are a variety of…</p>
</div>
<div id="getting-started" class="section level3">
<h3>Getting started</h3>
<p><strong>Installations</strong></p>
<p>Let’s get started by downloading all four packages from the
govscienceuseR GitHub page and loading them into our library. All of the
dependent packages required should be imported when we load in these
packages. You may be prompted to install some of the dependent packages
if you do not already have them, such as <code>keras</code>.</p>
<pre class="r"><code>devtools::install_github(&quot;govscienceuseR/referenceExtract&quot;)
devtools::install_github(&quot;govscienceuseR/referenceClassify&quot;)
devtools::install_github(&quot;govscienceuseR/referenceBuild&quot;)
devtools::install_github(&quot;govscienceuseR/citationSearch&quot;)
library(referenceExtract)
library(referenceClassify)
library(referenceBuild)
library(citationSearch)
packs = c(&#39;data.table&#39;, &#39;dplyr&#39;, &#39;stringr&#39;, &#39;keras&#39;, &#39;tensorflow&#39;,
          &#39;tidyr&#39;, &#39;purrr&#39;, &#39;ggplot2&#39;)
sapply(packs, require, character.only = T)</code></pre>
<p>You’ll also need to install solr</p>
<p>In your command line/terminal, navigate to your solr download, then
start a cloud instance by ..</p>
<pre><code>path/to/solr.9.0.1/bin/solr start -c</code></pre>
<p><strong>Data</strong></p>
<p>The data we’ll be using are documents for California’s Groundwater
Sustainability Plans. These documents are available publicly to download
from <a
href="https://ucdavis.box.com/s/9m3dogbibkrwy01pg4sdwouhzl8i6sef">Box</a>.
Feel free to download them to your computer to a file that will be
considered your document directory. There are 114 plans, which total X
pages. We will set our document directory to this folder of PDFs.</p>
<pre class="r"><code>doc_directory &lt;- &quot;~/Box/reference_classifier/documents_gsp/&quot;</code></pre>
<pre class="r"><code>pdfinfo &lt;- lapply(list.files(doc_directory, full.names = T),
               pdftools::pdf_info)
pdfs &lt;- data.frame(do.call(&#39;rbind&#39;, pdfinfo))
pages &lt;- sum(as.numeric(pdfs$pages))
pages/nrow(pdfs)</code></pre>
<p>Using these GSP documents we’ll be walking through the following
steps of the process:</p>
<p><img src="img/workflow.png" width="100%" /></p>
</div>
<div id="referenceextract" class="section level3">
<h3>1. <code>referenceExtract</code></h3>
<p>The referenceExtract tool from govscienceuseR is designed to take
unstructured PDF documents, feed them through the <a
href="https://anystyle.io/">anystyle.io</a> citation extraction
software, and return tagged citation data in a tabular format.</p>
<p>The first step of extracting references is to input PDF documents
into the <code>reference_extract</code> function. This function reads in
every PDF in the document directory (doc_dir), and runs them through
anystyle.io. Anystyle extracts probable citations and exports them to
the reference directory (ref_dir) as JSON files. Depending on the number
and size of files, this can take some time. For example, these documents
took over an hour to extract.</p>
<pre class="r"><code>ref_directory &lt;- &quot;data/ref_dir&quot;
reference_extract(doc_dir = doc_directory, 
                 ref_dir = ref_directory, 
                 layout = &quot;none&quot;)</code></pre>
<p>After extractions we have a JSON file for each PDF document.</p>
<p>Next, the <code>reference_compile</code> function transforms those
JSONs to tabular data and compiles them all into one data table, adding
the file name as an identifier.</p>
<pre class="r"><code>dt &lt;- reference_compile(ref_directory)</code></pre>
<p>After these first two steps we can take a look at our probable
citations from Anystyle. There are 26528 probable citations across these
114 documents.</p>
<div id="htmlwidget-5e13cd56e48e175ea4e4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5e13cd56e48e175ea4e4">{"x":{"filter":"none","vertical":false,"data":[[{"family":["Ayers","Westcot"],"given":["R.S.","D.W."]},null,null,null,null,{"family":["Water Resources"],"given":["California Department"],"particle":["of"]},{"family":["Water Resources"],"given":["California Department"],"particle":["of"]},null,null,{"family":["Daly","Neilson","Phillips"],"given":["C.","R.P.","D.L."]},{"family":["Davis","Green","Olmsted","Brown"],"given":["G.H.","J.H.","F.H.","D.W."]},null,{"given":["Sink","G.H.","Z.A."],"family":[null,"Hargreaves","Samani"]},{"family":["Hopkins","B"],"given":["J.","Anderson"]},{"family":["Schmidt",null],"given":["Kenneth D.","Associates"]},{"family":["MacGillivray"],"given":["N.A."]},{"family":["County"],"given":["Madera"]},{"family":["County"],"given":["Madera"]},null,{"family":["Hayes","Eching"],"given":["S.","S."]},{"family":["Page"],"given":["R.W."]},{"given":["Provost","Pritchard Consulting"],"family":[null,"Group"]},{"family":["Program"],"given":["San Joaquin River Restoration"]},null,{"family":["Program"],"given":["San Joaquin River Restoration"]},{"family":["Board"],"given":["State Water Resources Control"]},{"family":["Agency"],"given":["U.S.Environmental Protection"]},{"given":["U.S.G.S."]},{"family":["Williamson","Prudic","Swain"],"given":["A.K.","D.E.","L.A."]},{"given":["A.E.C.O.M."]},null,{"family":["Belitz","Heimes"],"given":["K.","F.J."]},{"family":["Bertoldi","Johnston","Evenson"],"given":["G.L.","R.H.","K.D."]},{"literal":["–"]},{"family":["Borchers","Carpenter"],"given":["J.W.","M."]},{"family":["Assembly"],"given":["California"]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{"family":["Board"],"given":["California State Water Resources Control"]},null,null,{"given":["Caltrans"]},null,{"given":["Caltrans"]},null,{"family":["Corwin"],"given":["D.L."]},{"family":["Croft"],"given":["M.G."]},null,{"family":["Davis","Poland"],"given":["G.H.","J.F."]},{"family":["Davis","Green","Olmstead","Brown"],"given":["G.H.","J.H.","S.H.","D.W."]},{"family":["Davis","Lofgren","Mack"],"given":["G.H.","B.E.","S."]},null,null,{"family":["Farr","Jones","Lieu"],"given":["Tom G.","Cathleen E.","Zhen"]},null,null,{"family":["Farrar","Bertoldi"],"given":["C.D.","G.L."]},{"family":["Faunt","Hanson","Belitz","Schmid","Predmore","Rewis","McPherson"],"given":["C.","R.T.","K.","W.","S.","D.L.","K."]},{"family":["Faunt","Belitz.","Hanson","Survey"],"given":["C.C.","K.","R.T.","Geological"]},{"family":["Faunt","Sneed","Traum","Brandt"],"given":["C.C.","M.","J.","J.T."]},{"family":["Fio"],"given":["J.L."]},{"family":["Foss","Blaisdell"],"given":["F.D.","R."]},{"family":["Galloway","Riley"],"given":["D.L.","F.S."]},{"family":["Galloway","Jones","Ingebritsen"],"given":["D.L.","D.R.","S.E."]},{"family":["Hotchkiss"],"given":["W.R."]},null,{"family":["Hotchkiss","Balding"],"given":["W.R.","G.O."]},{"family":["Ireland"],"given":["R.L."]},{"family":["R.L.","Poland","Riley"],"given":["Ireland","J.F.","F.S."]},{"family":["Jacob"],"given":["C.E."]},{"family":["Jennings","Strand"],"given":["C.W.","R.G."]},null,{"family":["Mendenhall","Dole","Stabler"],"given":["W.C.","R.B.","H."]},{"given":["Luhdorff","Scalmanini Consulting"],"family":[null,"Engineers"]}],[["1985","XXXX"],"2003",null,"1981-12","1991-06",["2016-12","2016-12"],["2017","XXXX"],["1949","XXXX"],"2019","1994","1959","2017-08-06","1982","2016-09","2013","1989",["1995-10-24","2008"],"2019",["2002","2006"],"2013","1973","2017-05-15",["2014","2018"],"2019","XXXX",["2018","2013"],["2006","2014","1969"],"XXXX","1989","2011","2018-07-25","1990","1991",null,"2014-04",["2014","1471"],null,"2013",null,"2016",null,"1965","1981",null,null,"1998","2003",null,"2017-06",null,"2017",null,"2018-05","2018",null,"2018-07",null,"2017-07-17","2018","2018","2019","2018-06",null,"1977","2011",null,null,"2017",null,"2018",null,"2012",["1972","1999"],"2019-08","1957","1959","1964","2017","2018-07-26","2017","2015 – September 2016",null,"1988","2009","2010","2015","1994","1968","1999","1999","1972","2019-08","1971","1986","1984","1940","1958",null,"1916","2011"],["Water Quality for Agriculture (FAO 29). Food and Agriculture Organization of the United Nations",["California Department of Water Resources (DWR","California’s Groundwater Bulletin"],null,["California Department of Water Resources (DWR","California Water Well Standards"],["California Department of Water Resources (DWR","California Water Well Standards: Supplement to Bulletin 74-81"],["Monitoring Networks and Identification of Data Gaps BMP","Monitoring Protocols, Standards, and Sites BMP"],["Draft Sustainable Management Criteria Best Management Practices","a_2017-11-06.pdf California Department of Water Resources","SGMA Data Viewer for Land Subsidence"],["California Open Data Portal","NASA JPL InSAR Subsidence Data"],null,"A statistical-topographic model for mapping climatological precipitation over mountainous terrain","Ground-Water Conditions and Storage Capacity in the San Joaquin Valley California",null,"Estimating potential evapotranspiration","A Field Manual for Groundwater-level Monitoring at the Texas Water Development Board, User Manual 52","Aliso Water District Groundwater Management Plan AB 303 Plan for Aliso Water District","Effective precipitation: a field study to assess consumptive use of winter rains by spring and summer crops",["Madera County General Plan Policy Document","Madera County"],"Madera County Municipal Code",["San Joaquin River Restoration Study Background Report, prepared for Friant Water Users Authority, Lindsay, CA, and Natural Resources Defense Council","Natural Resources Defense Council v","San Joaquin River Restoration Settlement"],"California simulation of evapotranspiration of applied water and agricultural energy use in California","Base of Fresh Groundwater (Approximately 3,000 Micromhos) in the San Joaquin Valley, California",null,["Seepage Management Plan, http://www.restoresjr.net/wp-content/uploads/2018/02/SMP_Draft_September_2014.pdf San Joaquin River Restoration Program (SJRRP","Channel Capacity Report 2018 Restoration Year. http://www.restoresjr.net/restoration-flows/levee-stability-channel-capacity/ San Joaquin River Restoration Program website"],null,"Water Quality",["Aliso Water District – Application to Appropriate Water","otices/2018/t032962_app.pdf Tetra Tech","San Joaquin River and Bypass System 1-D Steady State HEC-RAS Model Documentation"],["Guidance on Systematic Planning Using the Data Quality Objectives Process","ess.pdf United States Bureau of Reclamation (USBR","Upper San Joaquin River Basin Storage Investigation","Contract Between the United Stated of America and the Newhall Land and Farming Company for Groundwater Pumping"],"Land Subsidence in California",["Groundwater Flow in the Central Valley, California. United States Geological Survey","*Note references for the Hydrogeologic Conceptual Model and Groundwater Conditions for the Aliso Water District GSP (sections 3.1 and 3.2) are included at the end of Appendix A"],"Groundwater Management Plan for the Northern Agencies in the Delta-Mendota Canal Service Area",null,"Character and Evolution of Ground-Water flow System in the Central Part of the Western San Joaquin Valley, California","Ground water in the","A Summary Report","Land Subsidence from Groundwater Use in California",["Assembly Bill No","Water Quality, Supply, and Infrastructure Improvements Act of 2014"],"California Department of Conservation, California Geologic Survey. Various dates. Faults shapefiles",["California Department of Fish and Wildlife","California Lakes shapefile"],null,["California Department of Fish and Wildlife","California Streams shapefile"],null,["California Department of Water Resources (DWR","San Joaquin Valley Drainage Investigation –San Joaquin Master Drain"],["California Department of Water Resources (DWR","Water Well Standards: State of California, Bulletin 74-81"],"California Department of Water Resources (DWR). 1991",null,["California Department of Water Resources (DWR","The California Water Plan Update"],["California Department of Water Resources (DWR","California’s Groundwater Bulletin 118 –Update 2003"],null,["California Department of Water Resources (DWR","California Aqueduct Subsidence Study"],null,["California Department of Water Resources (DWR","DRAFT Best Management Practices for the"],"Sustainable Management of Groundwater: Sustainable Management Criteria BMP",["California Department of Water Resources (DWR","Evaluation of the Effect of Subsidence on Flow Capacity in the Chowchilla and Eastside Bypasses, and Reach 4A of the"],"Received via personal communication with Alexis R",null,["California Department of Water Resources (DWR","Water Data Library database"],"California Department of Water Resources (DWR). 2018a",null,["California Department of Water Resources (DWR","Economically Distressed Areas Mapping Tool"],["California Department of Water Resources (DWR","Natural Communities Commonly Associated with Groundwater (NCCAG) dataset"],["California Department of Water Resources (DWR","CA Bulletin 118 Groundwater Basins shapefile"],["California Natural Resources Agency","NASA JPL InSAR Subsidence Data"],null,["California State Water Resources Control Board (SWRCB","San Joaquin Valley Interagency Drainage Program Environmental Assessment – Phase I. Prepared for the California State Water Resources Control Board by Environmental Impact Planning Corporation"],"CV-SALTS Lower San Joaquin River Committee, April 28, 2011 Meeting Materials, Agenda Item 4 – Problem Statement","California State Water Resources Control Board (SWRCB). n.d (a). State Intervention – The State Back Stop, Sustainable Groundwater Management Act (SGMA","California State Water Resources Control Board (SWRCB). n.d (b). What is a Public Water System?","Caltrans Adjusted County Boundaries shapefile",null,"California National Highway System shapefile",null,"Field-scale monitoring of the long-term impact and sustainability of drainage water reuse on the west side of California’s San Joaquin Valley","Subsurface geology of the Late Tertiary and Quarternary water-bearing deposits of the southern part of the",null,"Ground-water conditions in the Mendota- Huron Area Fresno and Kings Counties, California","Ground water conditions and storage capacity in the San Joaquin Valley, California","Use of ground-water reservoirs for storage of surface water in the San Joaquin Valley California",["East Stanislaus Regional Water Management Group","East Stanislaus Region Integrated Regional"],"Water Management Plan Update – Public Draft",null,"Jet Propulsion Laboratory",null,"Region 4, Central Valley and Pacific Coast Ranges","Groundwater availability of the Central Valley Aquifer, California","Development of a three-dimensional model of sedimentary texture in valley-fill deposits of Central Valley","Water availability and land subsidence in the Central Valley","Calculation of a water budget and delineation of contributing sources to drainflows in the Western San Joaquin Valley, California","Stratigraphy of the West Side Southern San Joaquin Valley","San Joaquin Valley, California—Largest human alteration of the Earth’s surface","Land subsidence in the United States","Generalized subsurface geology of water-bearing deposits",null,"hydrology, and water quality of the Tracy-Dos Palo area","Land subsidence in the San Joaquin Valley, California, as of 1983","Land subsidence in the San Joaquin Valley, California, as of 1980","On the flow of water in an elastic artesian aquifer","Geological Atlas of California","California Geological Survey, Geologic Atlas of California Map","Ground water in the San Joaquin Valley, California","State of California Well Completion Report"],["California Data Exchange Center",null,null,"California’s Groundwater Bulletin","California’s Groundwater Bulletin","California Department of Water Resources (DWR",null,null,null,"Journal of applied meteorology","United States Geological Survey",null,"Journal of Irrigation and Drainage Engineering",null,null,null,null,null,"United State Bureau of Reclamation (NRDC","J. Integr. Agric",null,null,null,null,null,"Inc","United States Bureau of Reclamation (USBR",null,null,null,null,"USGS WaterSupply Paper 2348",null,"U.S. Geological Survey Professional Paper 1401-A",null,null,null,null,null,null,null,"Department of Water Resources Bulletin No.127",null,"California Well Standards",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"Journal of Environmental Monitoring",null,null,"U.S. Geological Survey Water Supply Paper","U.S. Geological Survey Water Supply Paper","U.S. Geological Survey Water-Supply Paper 1618",null,null,null,null,null,"Hydrogeology: Boulder, Colorado, Geological Society of America, Geology of North America","U.S. Geological Survey Professional Paper 1766","Hydrogeology Journal",null,null,null,"Land Subsidence in the United States: U.S. Geological Survey Circular 1182","U.S. Geological Survey Circular",null,null,null,"U.S. Geological Survey Water Resources Investigations Report","U.S. Geological Survey Professional Paper","American Geophysical Union Trans., pt",null,null,"U.S. Geological Survey Water-Supply Paper",null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>author<\/th>\n      <th>date<\/th>\n      <th>title<\/th>\n      <th>container-title<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>It is noticeable above that the data provided by Anystyle has its
challenges for further analysis. The first is a structural: authors are
nested into a matrix, some rows have listed values, etc., all of which
make the data hard to analyze. The second is a quality challenge,
whereby many of the probable citations are not sensible. While many look
correct, others look liek they have been smashed together into one
observation, or they look like false positives: no citations at all.</p>
<p>For example, here is what looks like two probable citations combined
into one observation:</p>
<pre class="r"><code>unnest(dt[204, c(2,3)])</code></pre>
<pre><code>## # A tibble: 3 × 2
##   date  title                                                                   
##   &lt;chr&gt; &lt;chr&gt;                                                                   
## 1 2017  Long‐Term Socio‐Economic Forecasts by County: Kings County              
## 2 2015  Progress Report: Subsidence in the Central Valley, California. For Depa…
## 3 2009  Ground‐water availability in California’s Central Valley</code></pre>
<p>And he is what looks like false positive, which are often things like
addresses:</p>
<pre class="r"><code>unlist(dt[148, c(1,3,5)])</code></pre>
<pre><code>##                                                                                      author.family 
##                                                                                             &quot;When&quot; 
##                                                                                       author.given 
##                                                                                        &quot;Firebaugh&quot; 
##                                                                                              title 
## &quot;5:00 - 7:00 PM Firebaugh Middle School MPR 1600 16th Street, Firebaugh, CA Los Banos – Wednesday&quot; 
##                                                                                   container-title1 
##                                                    &quot;PM College Greens Building 1815 Scripps Drive&quot; 
##                                                                                   container-title2 
##                                                &quot;PM Hammon Senior Center 1033 W. Las Palmas Avenue&quot; 
##                                                                                   container-title3 
##                                                                                           &quot;Monday&quot;</code></pre>
<p>To try to address the challenges in these probable citations, the
<code>reference_clean</code> function goes through a series of steps.
For each column the function unlists the data and filters out unlikely
candidates for that column. For instance, if a number listed in the date
column does not match any reasonable date format or expectation, it is
removed. If a string in the URL column actually resembles a DOI, it is
moved to that column. And so on. Furthermore, if there seem to be
multiple citations listed in one row that can be broken apart in
parallel across all of the columns, we unnest these rows. (Note:
depending on the size of the files this function may take some time.
Cleaning these 26528 citations takes about 18 minutes)</p>
<pre class="r"><code>dt &lt;- reference_clean(dt)</code></pre>
<p>This cleaning process has changed probable citations now a bit. Some
of the probable citations have been unnested (and therefore expanded)
while others have been removed, leaving us with 14423 probable
citations.</p>
<div id="htmlwidget-5228677fa3ec0e819a99" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5228677fa3ec0e819a99">{"x":{"filter":"none","vertical":false,"data":[["Ayers, RS; Westcot, DW",null,null,null,null,"California Department of Water Resources","California Department of Water Resources",null,null,"Daly, C; Neilson, RP; Phillips, DL","Davis, GH; Green, JH; Olmsted, FH; Brown, DW","Sink; Hargreaves, GH; Samani, ZA","Hopkins, J; B, Anderson","Schmidt, Kenneth D; Associates","MacGillivray, NA","Madera County","Madera County",null,"Hayes, S; Eching, S","Page, RW","Provost; Group, Pritchard Consulting","Program, San Joaquin River Restoration",null,"Program, San Joaquin River Restoration","State Water Resources Control Board","USEnvironmental Protection Agency","USGS","Williamson, AK; Prudic, DE; Swain, LA","AECOM","Belitz, K; Heimes, FJ","Bertoldi, GL; Johnston, RH; Evenson, KD",null,"Borchers, JW; Carpenter, M","Assembly, California",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"California State Water Resources Control Board",null,null,"Caltrans",null,"Caltrans",null,"Corwin, DL","Croft, MG","Davis, GH; Poland, JF","Davis, GH; Green, JH; Olmstead, SH; Brown, DW","Davis, GH; Lofgren, BE; Mack, S",null,null,"Farr, Tom G; Jones, Cathleen E; Lieu, Zhen",null,"Farrar, CD; Bertoldi, GL","Faunt, C; Hanson, RT; Belitz, K; Schmid, W; Predmore, S; Rewis, DL; McPherson, K","Faunt, CC; Belitz, K; Hanson, RT; Survey, Geological","Faunt, CC; Sneed, M; Traum, J; Brandt, JT","Fio, JL","Foss, FD; Blaisdell, R","Galloway, DL; Riley, FS","Galloway, DL; Jones, DR; Ingebritsen, SE","Hotchkiss, WR","Hotchkiss, WR; Balding, GO","Ireland, RL","RL, Ireland; Poland, JF; Riley, FS","Jacob, CE","Jennings, CW; Strand, RG","Mendenhall, WC; Dole, RB; Stabler, H","Luhdorff; Engineers, Scalmanini Consulting","Luhdorff; Engineers, Scalmanini Consulting; Engineering, Davids; Associates, Larry Walker","Luhdorff; Engineers, Scalmanini Consulting","Madera Regional Water Management Group","McBain; Trush, Inc","Mosley, J","National Resources Conservation Service",null,"Ogden, GR","Page, RW",null,"Poland, JF; Lofgren, BE; Ireland, RL; Pugh, AG","Rohde, MM; Matsumoto, S; Howard, J; Liu, S; Riege, L; Remson, EJ"],["1985","2003",null,"1981","1991","2016","2017","1949","2019","1994","1959","1982","2016","2013","1989","1995","2019","2002","2013","1973","2017","2014","2019",null,"2018","2006",null,"1989","2011","1990","1991",null,"2014","2014",null,"2013",null,"2016","1965","1981",null,"1998","2003",null,"2017",null,"2017",null,"2018","2018","2017","2018","2018","2019","2018",null,"2011",null,null,"2017",null,"2018",null,"2012","1972","1957","1959","1964","2017","2018","2017",null,"1988","2009","2010","2015","1994","1968","1999","1999","1972","1971","1986","1984","1940","1958","1916","2011","2015","2016","2014","2002","2017","2009",null,"1988","1973",null,"1975","2018"],["Water Quality for Agriculture FAO 29 Food and Agriculture Organization of the United Nations","Californias Groundwater Bulletin",null,"California Water Well Standards","California Water Well Standards Supplement to Bulletin 7481","Monitoring Networks and Identification of Data Gaps BMP Monitoring Protocols Standards and Sites BMP","Draft Sustainable Management Criteria Best Management Practices SGMA Data Viewer for Land Subsidence","California Open Data Portal NASA JPL InSAR Subsidence Data",null,"A Statisticaltopographic Model for Mapping Climatological Precipitation over Mountainous Terrain","GroundWater Conditions and Storage Capacity in the San Joaquin Valley California","Estimating Potential Evapotranspiration",null,null,"Effective Precipitation a Field Study to Assess Consumptive Use of Winter Rains by Spring and Summer Crops",null,null,"San Joaquin River Restoration Settlement","California Simulation of Evapotranspiration of Applied Water and Agricultural Energy Use in California","Base of Fresh Groundwater Approximately 3000 Micromhos in the San Joaquin Valley California",null,"Seepage Management Plan httpwwwrestoresjrnetwpcontentuploads201802SMP_Draft_September_2014pdf San Joaquin River Restoration Program SJRRP Channel Capacity Report 2018 Restoration Year Httpwwwrestoresjrnetrestorationflowsleveestabilitychannelcapacity San Joaquin River Restoration Program Website",null,"Water Quality","Otices2018t032962_apppdf Tetra Tech San Joaquin River and Bypass System 1d Steady State HECRAS Model Documentation","Guidance on Systematic Planning Using the Data Quality Objectives Process Upper San Joaquin River Basin Storage Investigation Contract Between the United Stated of America and the Newhall Land and Farming Company for Groundwater Pumping","Land Subsidence in California",null,null,"Character and Evolution of GroundWater Flow System in the Central Part of the Western San Joaquin Valley California","Ground Water in the","A Summary Report","Land Subsidence from Groundwater Use in California","Assembly Bill No Water Quality Supply and Infrastructure Improvements Act of 2014",null,"California Lakes Shapefile",null,"California Streams Shapefile","San Joaquin Valley Drainage Investigation San Joaquin Master Drain","Water Well Standards State of California Bulletin 7481",null,"The California Water Plan Update","Californias Groundwater Bulletin 118 Update 2003",null,"California Aqueduct Subsidence Study",null,"DRAFT Best Management Practices for the","Sustainable Management of Groundwater Sustainable Management Criteria BMP","Evaluation of the Effect of Subsidence on Flow Capacity in the Chowchilla and Eastside Bypasses and Reach 4a of the","Water Data Library Database",null,"Economically Distressed Areas Mapping Tool","Natural Communities Commonly Associated with Groundwater NCCAG Dataset","CA Bulletin 118 Groundwater Basins Shapefile","NASA JPL InSAR Subsidence Data",null,"CVSALTS Lower San Joaquin River Committee April 28 2011 Meeting Materials Agenda Item 4 Problem Statement",null,null,null,null,"California National Highway System Shapefile",null,"Fieldscale Monitoring of the Longterm Impact and Sustainability of Drainage Water Reuse on the West Side of Californias San Joaquin Valley","Subsurface Geology of the Late Tertiary and Quarternary Waterbearing Deposits of the Southern Part of the","Groundwater Conditions in the Mendota Huron Area Fresno and Kings Counties California","Ground Water Conditions and Storage Capacity in the San Joaquin Valley California","Use of Groundwater Reservoirs for Storage of Surface Water in the San Joaquin Valley California","East Stanislaus Region Integrated Regional","Water Management Plan Update Public Draft",null,null,"Region 4 Central Valley and Pacific Coast Ranges","Groundwater Availability of the Central Valley Aquifer California","Development of a Threedimensional Model of Sedimentary Texture in Valleyfill Deposits of Central Valley","Water Availability and Land Subsidence in the Central Valley","Calculation of a Water Budget and Delineation of Contributing Sources to Drainflows in the Western San Joaquin Valley California","Stratigraphy of the West Side Southern San Joaquin Valley","San Joaquin Valley CaliforniaLargest Human Alteration of the Earths Surface","Land Subsidence in the United States","Generalized Subsurface Geology of Waterbearing Deposits","Hydrology and Water Quality of the TracyDos Palo Area","Land Subsidence in the San Joaquin Valley California as of 1983","Land Subsidence in the San Joaquin Valley California as of 1980","On the Flow of Water in an Elastic Artesian Aquifer","Geological Atlas of California","Ground Water in the San Joaquin Valley California","State of California Well Completion Report","Western San Joaquin River Watershed Groundwater Quality Assessment Report","Grassland Drainage Area Groundwater Quality Assessment Report","Madera Integrated Regional Water Management Plan Final Draft",null,null,null,null,"Agricultural Land Use and Wildlife in the San Joaquin Valley 17691930 an Overview","Base of Fresh Groundwater Approximately 2000 Micromhos in the San Joaquin Valley",null,"Land Subsidence in the San Joaquin Valley California as of 1972 US","Groundwater Dependent Ecosystems under the Sustainable Groundwater Management Act Guidance for Preparing Groundwater Sustainability Plans"],["California Data Exchange Center",null,null,"Californias Groundwater Bulletin","Californias Groundwater Bulletin","California Department of Water Resources DWR",null,null,null,"Journal of Applied Meteorology","United States Geological Survey","Journal of Irrigation and Drainage Engineering",null,null,null,null,null,"United State Bureau of Reclamation NRDC","J Integr Agric",null,null,null,null,null,"Inc","United States Bureau of Reclamation USBR",null,null,null,"USGS WaterSupply Paper 2348",null,"US Geological Survey Professional Paper 1401a",null,null,null,null,null,null,"Department of Water Resources Bulletin No127",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"Journal of Environmental Monitoring",null,"US Geological Survey Water Supply Paper","US Geological Survey Water Supply Paper","US Geological Survey WaterSupply Paper 1618",null,null,null,null,"Hydrogeology Boulder Colorado Geological Society of America Geology of North America","US Geological Survey Professional Paper 1766","Hydrogeology Journal",null,null,null,"Land Subsidence in the United States US Geological Survey Circular 1182","US Geological Survey Circular",null,null,"US Geological Survey Water Resources Investigations Report","US Geological Survey Professional Paper","American Geophysical Union Trans Pt",null,"US Geological Survey WaterSupply Paper",null,null,null,null,null,null,null,null,"SOLO Heritage Research San Joaquin Valley Drainage Program US Department of Interior",null,null,"Geological Survey Professional Paper",null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>author<\/th>\n      <th>year<\/th>\n      <th>title<\/th>\n      <th>container<\/th>\n      <th>publisher<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="referenceclassify" class="section level3">
<h3>2. <code>referenceClassify</code></h3>
<p>The <code>referenceClassify</code> package is designed to take a data
frame of tabular, tagged citation data (author, year, container,
publisher, doi, etc), look for exact matches between those tags and
various high-level indices (mainly journal and agency names), and begin
to classify probable citations into these high-level categories.</p>
<p>Based on our initial cleaning of the GSP data in the previous
section, we can see which of these probable citations are exact matches
to three different indices: an index of academic journals from the
Scimago database, an index of academic conference papers/proceedings
also from the Scimago database, and an index of US state and federal
agencies, curated by the package authors. We can look for matches using
the <code>journal_match()</code>, <code>conference_match()</code> and
<code>agency_match()</code> functions.</p>
<pre class="r"><code>table(journal_match(dt$container))</code></pre>
<pre><code>## 
## FALSE  TRUE 
## 13543   880</code></pre>
<pre class="r"><code>table(conference_match(dt$container))</code></pre>
<pre><code>## 
## FALSE  TRUE 
## 14420     3</code></pre>
<pre class="r"><code>table(agency_match(dt$container, dt$author))</code></pre>
<pre><code>## 
## FALSE  TRUE 
## 13967   456</code></pre>
<p>After this initial assessment, we can further clean and refine these
potential citations with the <code>prepared_by</code> function, which
removes commonly-seen lead-ins to references (‘prepared for/by’, etc.)
to improve exact matching.</p>
<pre class="r"><code>dt &lt;- prepared_by(dt, x = &#39;container&#39;, y = &#39;author&#39;, z = &#39;publisher&#39;)</code></pre>
<p>Next, we disambiguate the journals with the
<code>journal_disambig</code> function, which references indices of
common journal abbreviations and through manual cleaning of journals
referenced in transportation documents.</p>
<pre class="r"><code>dt$container &lt;- journal_disambig(dt$container)</code></pre>
<p>Third, we use regular expressions to look at our cleaned data and
classify it based on exact matches with regular expressions using the
<code>regex_classify()</code> function. This function does two things.
First it looks across all of the columns for exact matches to our
indices, and if there is an exact match, it pulls out that value into a
‘input’ column. If there is not exact match, the value in the input
column will be selected in the following order of preference: doi,
container, publisher, title, author. Second, based on the matches the
function will assign the potential citation into one of four classes:
journal, agency, conference, or none. If none of the potential
citations’ data is an exact match to any of the indices, the
classification is NA.</p>
<pre class="r"><code>dt &lt;- regex_classify(dt, &#39;container&#39;)</code></pre>
<p>Based on these classifications, we can see the counts of exact
matches:</p>
<pre class="r"><code>table(dt$class)</code></pre>
<pre><code>## 
##     agency conference    journal remove_row 
##       1867          3        997        146</code></pre>
<p>However, we can see that many of the probable citations have been
left unmatched:</p>
<pre class="r"><code>table(is.na(dt$class))</code></pre>
<pre><code>## 
## FALSE  TRUE 
##  3013 10899</code></pre>
<p>Next we want to classify the probable references that are not exact
matches to any of our indices. To do this, we input our unclassified
references into a neural network trained to predict the reference class
of probable citations. We used data from Environmental Impact
Statements, classified through both manual classification and the
semi-automated regex classification explained above. This model is X%
effective on EIS data…</p>
<p>We can run this model on the whole data frame, and compare our regex
classification with the Keras classifications to get a sense of the
model performance.</p>
<pre class="r"><code># Need to set this wd right now because I can&#39;t actually get the model object to save within the package itself
setwd(&quot;~/Documents/Davis/R-Projects/referenceClassify/&quot;)
# Something is wrong with the auto_input
predictions &lt;- keras_classify(dt, probability = .85, 
                              &#39;container&#39;, auto_input = F,
                              &#39;training_input&#39;) 
dt &lt;- cbind(dt, select(predictions, predict_class))</code></pre>
<pre class="r"><code>dt &lt;- dt %&gt;% 
  mutate(class = case_when(
           class == &quot;remove_row&quot; ~ &quot;delete&quot;,
           T ~ class),
         method = case_when(
           is.na(class) ~ &quot;keras&quot;,
           T ~ &quot;regex&quot;),
         method_comparison = case_when(
           method == &quot;regex&quot; &amp; class == predict_class ~ &quot;match&quot;,
           method == &quot;regex&quot; &amp; predict_class == &quot;unsure&quot; ~ &quot;unsure&quot;,
           method == &quot;regex&quot; &amp; class != predict_class ~ &quot;incorrect&quot;,
           T ~ NA_character_))
table(dt$method_comparison)</code></pre>
<pre><code>## 
## incorrect     match    unsure 
##        30      2801       182</code></pre>
<p>These results, altogether, suggest that the Keras model is 93%
accurate in its prediction of the citations we are able to do exact
matching for.</p>
<p>Now, let’s unify the classification columns and have a look at the
total for each estimated grouping.</p>
<pre class="r"><code>dt$class &lt;- ifelse(is.na(dt$class), dt$predict_class, dt$class)
table(dt$class)</code></pre>
<pre><code>## 
##     agency conference     delete    journal     unsure 
##       3675          5       3163       1856       5213</code></pre>
<p>And we’ll tidy up these data by filtering out the citations
classificied to ‘delete’ (the false positives) in preparation for our
indexing in the next step.</p>
<pre class="r"><code>dt &lt;- dt %&gt;% 
  select(-c(predict_class, method_comparison)) %&gt;% 
  filter(class != &quot;delete&quot;)</code></pre>
<p>What are we left with? We can take a look at the journals and
agencies:</p>
<p><strong>I NEED TO ACTUALLY MATCH THE AGENCY</strong></p>
<p><img src="gsp_vignette_files/figure-html/unnamed-chunk-10-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="indexbuild" class="section level3">
<h3>3. <code>indexBuild</code></h3>
<p>Now that we have a general sense of what kind of citation types are
represented within the probable citations, the next step is to try to
index these citations exactly.</p>
<p>First we need to generate an index. The indexBuild function wraps
around the OpenAlex API</p>
<p>First, what are the areas we already have known references from? We
koad in the Scimago database, including journal metdata, to get an
understanding of what journals can be identified through exact
matching.</p>
<pre class="r"><code>themes &lt;- dt_journals %&gt;% 
  select(sourceid, journal_title, cat1:cat15) %&gt;% 
  pivot_longer(cols = cat1:cat15, 
               names_to = &quot;number&quot;,
               values_to = &quot;cat&quot;) %&gt;% 
  filter(!is.na(cat)) %&gt;% 
  mutate(cat = trimws(str_remove_all(cat, &#39;\\(Q\\d\\)&#39;))) %&gt;% 
  mutate(cat = trimws(str_remove_all(tolower(cat),
                                     &#39;\\(miscellaneous\\)|,|-&#39;))) %&gt;% 
  group_by(cat) %&gt;% 
  count() %&gt;% 
  arrange(n) %&gt;% 
  mutate(cat = factor(cat, levels = .$cat))</code></pre>
<p><img src="gsp_vignette_files/figure-html/unnamed-chunk-14-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>Let’s use these themes and keywords to inform our index creation. I
build in a quick bit of sleep time for querying the concepts from
openAlex, then apply this functions across all of the themes and
keywords existing in the data. (Note: This querying of over 200 concepts
takes ~5 minutes.)</p>
<pre class="r"><code>query_slowly &lt;- function(x){
  index &lt;- queryConcepts(concept_string = x, 
                         per_page = 50)
  return(index)
  Sys.sleep(1)
}
index &lt;- lapply(c(themes$cat, keywords$word), query_slowly)
# For whatever reason there was no description column for 7
index[[12]]$description &lt;- &quot;&quot;
indexdf &lt;- do.call(&#39;rbind&#39;, index) %&gt;% unique()</code></pre>
<p>Now we have a number of resources representing the concepts from our
existing data. Here is a random look at some of them.</p>
<div id="htmlwidget-62adbab66a7ee6a6ff1c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-62adbab66a7ee6a6ff1c">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100"],["https://openalex.org/C53927964","https://openalex.org/C202353208","https://openalex.org/C117959457","https://openalex.org/C46721173","https://openalex.org/C8880873","https://openalex.org/C2982889124","https://openalex.org/C82492881","https://openalex.org/C159750122","https://openalex.org/C2779516188","https://openalex.org/C2778251979","https://openalex.org/C152662350","https://openalex.org/C68365596","https://openalex.org/C135646171","https://openalex.org/C548081761","https://openalex.org/C93011207","https://openalex.org/C174988536","https://openalex.org/C2780765947","https://openalex.org/C2776325102","https://openalex.org/C162118730","https://openalex.org/C10050518","https://openalex.org/C29123130","https://openalex.org/C118419359","https://openalex.org/C2778073708","https://openalex.org/C50516716","https://openalex.org/C168314062","https://openalex.org/C104060986","https://openalex.org/C142870003","https://openalex.org/C3018325918","https://openalex.org/C2777987666","https://openalex.org/C165148211","https://openalex.org/C185544564","https://openalex.org/C2992992772","https://openalex.org/C14961307","https://openalex.org/C155560232","https://openalex.org/C16889073","https://openalex.org/C2993054902","https://openalex.org/C110083411","https://openalex.org/C22684755","https://openalex.org/C2993120057","https://openalex.org/C2779463800","https://openalex.org/C172057663","https://openalex.org/C64389972","https://openalex.org/C68001002","https://openalex.org/C71864017","https://openalex.org/C190463098","https://openalex.org/C188533889","https://openalex.org/C81893864","https://openalex.org/C2780844640","https://openalex.org/C126691448","https://openalex.org/C190040717","https://openalex.org/C2777483948","https://openalex.org/C15696416","https://openalex.org/C100339178","https://openalex.org/C99730327","https://openalex.org/C2994198235","https://openalex.org/C64248961","https://openalex.org/C126314574","https://openalex.org/C2781176444","https://openalex.org/C2776475305","https://openalex.org/C63847988","https://openalex.org/C109643173","https://openalex.org/C148335973","https://openalex.org/C2993438527","https://openalex.org/C2779478453","https://openalex.org/C2988005100","https://openalex.org/C66465714","https://openalex.org/C2780598303","https://openalex.org/C73374054","https://openalex.org/C163109420","https://openalex.org/C146978453","https://openalex.org/C191120209","https://openalex.org/C70247577","https://openalex.org/C56739046","https://openalex.org/C106613895","https://openalex.org/C3454156","https://openalex.org/C2984223407","https://openalex.org/C3019808023","https://openalex.org/C56685638","https://openalex.org/C2779275509","https://openalex.org/C170751736","https://openalex.org/C83209312","https://openalex.org/C128536511","https://openalex.org/C33923547","https://openalex.org/C151375590","https://openalex.org/C2780492012","https://openalex.org/C509746633","https://openalex.org/C65409693","https://openalex.org/C50382708","https://openalex.org/C2779379648","https://openalex.org/C57827392","https://openalex.org/C141261163","https://openalex.org/C2776861996","https://openalex.org/C2778573023","https://openalex.org/C2776510970","https://openalex.org/C144587487","https://openalex.org/C2779560602","https://openalex.org/C5570062","https://openalex.org/C2993211907","https://openalex.org/C2780271678","https://openalex.org/C137209882"],["Environmental enrichment","Economic indicator","Biological anthropology","Endocannabinoid system","Genetic algorithm","Disease management","Ecological efficiency","Soil water","Travel medicine","Visual processing","Systems biology","Medical law","Analytic philosophy","Waste management","Geotechnical investigation","Dynamic decision-making","Administration (probate law)","Water-use efficiency","Actuarial science","Primary education","Computational geometry","Supercritical fluid","Language development","Soil test","Absorption of water","Space exploration","Genetic linkage","Low earth orbit","Fractional flow reserve","Social inequality","Nuclear physics","Plant metabolism","Energy minimization","Statistical energy analysis","Magnetic susceptibility","Water chemistry","Statistical classification","Queueing theory","Crop productivity","Center (category theory)","Atmospheric duct","Biological specimen","Organizational behavior and human resources","Soil map","Quantum technology","Electron magnetic dipole moment","Carbon-neutral fuel","History of depression","Magnitude (astronomy)","Natural philosophy","Sustainable Value","Surface diffusion","Collective behavior","Sobolev space","Workplace safety","Water activity","Air quality index","Monitoring the Future","Public interest","Ecological psychology","Environment variable","Physical organic chemistry","Dense matter","Modularity (biology)","Proton magnetic resonance","Water balance","Flexibility (engineering)","Economic stability","Global Forecast System","Aerospace engineering","Structural biology","Fuel mass fraction","Knowledge management","Electronic differential","Side effect (computer science)","Brain development","State policy","Power control","Compulsive behavior","Tetragonal crystal system","Predictive analytics","History of religions","Mathematics","Noisy text analytics","Marine pollution","Climate change mitigation","Statistical significance","Proportional hazards model","Multiphase flow","Occupational hygiene","Corporate social responsibility","Sensory processing","International humanitarian law","Regional policy","Systemic risk","Theory of mind","Behavioural sciences","Management philosophy","Leadership development","Measurement uncertainty"],[2,2,2,3,2,4,2,2,2,3,2,2,3,1,2,2,2,3,1,2,2,2,2,3,2,2,3,3,4,3,1,4,2,3,2,2,2,2,3,2,3,2,3,3,4,4,4,3,2,2,3,3,2,2,3,3,2,3,2,2,2,2,3,2,2,2,2,2,3,1,2,5,1,3,2,2,3,3,2,3,2,2,0,4,3,3,2,2,2,3,2,3,3,2,3,3,2,2,2,2],[4123,7344,5061,15417,160784,18021,506,792485,2834,8603,18510,13321,22987,1963695,5296,903,252444,14618,563468,44443,5441,72090,19253,39979,34854,22981,28218,9983,8758,21759,2417171,2269,7415,1979,36291,3016,11587,55754,4732,282004,1579,1726,7610,4966,8903,4688,741,1295,47643,5544,1738,9356,3846,29219,3798,8708,65249,1758,16685,1611,432,572,1396,23443,7173,24516,272812,5445,2236,2576823,4423,910,1395309,1731,16272,6887,3193,33543,1724,56185,4478,13664,26768501,235,6252,12570,65832,182789,13529,8334,99741,6053,10035,7252,17009,12215,9390,1819,14549,18224],["https://api.openalex.org/works?filter=concepts.id:C53927964","https://api.openalex.org/works?filter=concepts.id:C202353208","https://api.openalex.org/works?filter=concepts.id:C117959457","https://api.openalex.org/works?filter=concepts.id:C46721173","https://api.openalex.org/works?filter=concepts.id:C8880873","https://api.openalex.org/works?filter=concepts.id:C2982889124","https://api.openalex.org/works?filter=concepts.id:C82492881","https://api.openalex.org/works?filter=concepts.id:C159750122","https://api.openalex.org/works?filter=concepts.id:C2779516188","https://api.openalex.org/works?filter=concepts.id:C2778251979","https://api.openalex.org/works?filter=concepts.id:C152662350","https://api.openalex.org/works?filter=concepts.id:C68365596","https://api.openalex.org/works?filter=concepts.id:C135646171","https://api.openalex.org/works?filter=concepts.id:C548081761","https://api.openalex.org/works?filter=concepts.id:C93011207","https://api.openalex.org/works?filter=concepts.id:C174988536","https://api.openalex.org/works?filter=concepts.id:C2780765947","https://api.openalex.org/works?filter=concepts.id:C2776325102","https://api.openalex.org/works?filter=concepts.id:C162118730","https://api.openalex.org/works?filter=concepts.id:C10050518","https://api.openalex.org/works?filter=concepts.id:C29123130","https://api.openalex.org/works?filter=concepts.id:C118419359","https://api.openalex.org/works?filter=concepts.id:C2778073708","https://api.openalex.org/works?filter=concepts.id:C50516716","https://api.openalex.org/works?filter=concepts.id:C168314062","https://api.openalex.org/works?filter=concepts.id:C104060986","https://api.openalex.org/works?filter=concepts.id:C142870003","https://api.openalex.org/works?filter=concepts.id:C3018325918","https://api.openalex.org/works?filter=concepts.id:C2777987666","https://api.openalex.org/works?filter=concepts.id:C165148211","https://api.openalex.org/works?filter=concepts.id:C185544564","https://api.openalex.org/works?filter=concepts.id:C2992992772","https://api.openalex.org/works?filter=concepts.id:C14961307","https://api.openalex.org/works?filter=concepts.id:C155560232","https://api.openalex.org/works?filter=concepts.id:C16889073","https://api.openalex.org/works?filter=concepts.id:C2993054902","https://api.openalex.org/works?filter=concepts.id:C110083411","https://api.openalex.org/works?filter=concepts.id:C22684755","https://api.openalex.org/works?filter=concepts.id:C2993120057","https://api.openalex.org/works?filter=concepts.id:C2779463800","https://api.openalex.org/works?filter=concepts.id:C172057663","https://api.openalex.org/works?filter=concepts.id:C64389972","https://api.openalex.org/works?filter=concepts.id:C68001002","https://api.openalex.org/works?filter=concepts.id:C71864017","https://api.openalex.org/works?filter=concepts.id:C190463098","https://api.openalex.org/works?filter=concepts.id:C188533889","https://api.openalex.org/works?filter=concepts.id:C81893864","https://api.openalex.org/works?filter=concepts.id:C2780844640","https://api.openalex.org/works?filter=concepts.id:C126691448","https://api.openalex.org/works?filter=concepts.id:C190040717","https://api.openalex.org/works?filter=concepts.id:C2777483948","https://api.openalex.org/works?filter=concepts.id:C15696416","https://api.openalex.org/works?filter=concepts.id:C100339178","https://api.openalex.org/works?filter=concepts.id:C99730327","https://api.openalex.org/works?filter=concepts.id:C2994198235","https://api.openalex.org/works?filter=concepts.id:C64248961","https://api.openalex.org/works?filter=concepts.id:C126314574","https://api.openalex.org/works?filter=concepts.id:C2781176444","https://api.openalex.org/works?filter=concepts.id:C2776475305","https://api.openalex.org/works?filter=concepts.id:C63847988","https://api.openalex.org/works?filter=concepts.id:C109643173","https://api.openalex.org/works?filter=concepts.id:C148335973","https://api.openalex.org/works?filter=concepts.id:C2993438527","https://api.openalex.org/works?filter=concepts.id:C2779478453","https://api.openalex.org/works?filter=concepts.id:C2988005100","https://api.openalex.org/works?filter=concepts.id:C66465714","https://api.openalex.org/works?filter=concepts.id:C2780598303","https://api.openalex.org/works?filter=concepts.id:C73374054","https://api.openalex.org/works?filter=concepts.id:C163109420","https://api.openalex.org/works?filter=concepts.id:C146978453","https://api.openalex.org/works?filter=concepts.id:C191120209","https://api.openalex.org/works?filter=concepts.id:C70247577","https://api.openalex.org/works?filter=concepts.id:C56739046","https://api.openalex.org/works?filter=concepts.id:C106613895","https://api.openalex.org/works?filter=concepts.id:C3454156","https://api.openalex.org/works?filter=concepts.id:C2984223407","https://api.openalex.org/works?filter=concepts.id:C3019808023","https://api.openalex.org/works?filter=concepts.id:C56685638","https://api.openalex.org/works?filter=concepts.id:C2779275509","https://api.openalex.org/works?filter=concepts.id:C170751736","https://api.openalex.org/works?filter=concepts.id:C83209312","https://api.openalex.org/works?filter=concepts.id:C128536511","https://api.openalex.org/works?filter=concepts.id:C33923547","https://api.openalex.org/works?filter=concepts.id:C151375590","https://api.openalex.org/works?filter=concepts.id:C2780492012","https://api.openalex.org/works?filter=concepts.id:C509746633","https://api.openalex.org/works?filter=concepts.id:C65409693","https://api.openalex.org/works?filter=concepts.id:C50382708","https://api.openalex.org/works?filter=concepts.id:C2779379648","https://api.openalex.org/works?filter=concepts.id:C57827392","https://api.openalex.org/works?filter=concepts.id:C141261163","https://api.openalex.org/works?filter=concepts.id:C2776861996","https://api.openalex.org/works?filter=concepts.id:C2778573023","https://api.openalex.org/works?filter=concepts.id:C2776510970","https://api.openalex.org/works?filter=concepts.id:C144587487","https://api.openalex.org/works?filter=concepts.id:C2779560602","https://api.openalex.org/works?filter=concepts.id:C5570062","https://api.openalex.org/works?filter=concepts.id:C2993211907","https://api.openalex.org/works?filter=concepts.id:C2780271678","https://api.openalex.org/works?filter=concepts.id:C137209882"],["effect of stimulating physical and social surroundings on the brain","measure, which allows statements about the economic situation in general of national economies","branch of anthropology that studies the physical development of the human species","receptors and endogenous neurotransmitters similar to cannabis","competitive algorithm for searching a problem space","topics referred to by the same term",null,null,"branch of medicine that deals with the prevention and management of health problems of international travelers","term","computational and mathematical modeling of complex biological systems","area of law dealing with the practice of medicine","style of philosophy","generation, prevention, characterization, monitoring, treatment, handling, reuse and residual disposition of solid wastes",null,null,null,null,"discipline that applies mathematical and statistical methods to assess risk in the insurance and finance industries","first stage of compulsory education","branch of computer science","state of matter","process starting early in human life",null,null,"discovery and exploration of outer space and celestial objects outside Earth","tendency of DNA sequences that are close together on a chromosome to be inherited together","orbit around Earth with an altitude between 160 kilometers and 2,000 kilometers","ratio or percentage of maximum blood flow to the myocardium with coronary stenosis present, to the maximum equivalent blood flow without stenosis","uneven distribution of resources in a society","field of physics that deals with the structure and behavior of atomic nuclei","subdiscipline of botany","way of exploring reaction paths in computational chemistry",null,"measure of how much a material will become magnetized in an applied magnetic field",null,"problem of identifying to which of a set of categories (sub-populations) a new observation belongs, on the basis of a training set of data containing observations (or instances) whose category membership is known","mathematical study of waiting lines, or queues","quotient between production and productive factors","center of a strict monoidal category",null,"laboratory specimen",null,"map showing diversity of soil types and/or properties","emerging technologies built on quantum mechanics","spin of an electron","type of fuel which have no net greenhouse gas emissions","aspect of history","Logarithmic measure of the brightness of an astronomical object","ancient philosophical study of nature and physical universe that was dominant before the development of modern science. It is considered to be the precursor of natural science",null,"general process involving the motion of adatoms, molecules, and atomic clusters (adparticles) at solid material surfaces","social processes and events which do not reflect existing social structure, but which emerge in a \"spontaneous\" way","Banach space of functions equipped with a norm that is a combination of Lᵖ-norms of the function itself and its derivatives up to a given order; the derivatives are understood in a suitable weak sense to make the space Banach","Wikimedia disambiguation page","one of the main factor limiting microbial activity","measure of pollution","long-term epidemiological study that surveys trends in legal and illicit drug use among American adolescents and adults","\"common well-being\" or \"general welfare\"",null,"dynamic value that affects the behavior of processes on a computer","discipline of organic chemistry","substance that has rest mass and volume, or several other definitions","modularity of biological systems","NMR via protons, hydrogen-1 nuclei","Looks at how water moves in a closed system","ability of an item to change to suit some purpose",null,"global meteorological forecasting mathematical model","branch of engineering","study of molecular structures in biology",null,"process of creating, sharing, using and managing the knowledge and information of an organization",null,"additional effect of a function in a procedural programming language besides returning a value","The process whose specific outcome is the progression of nervous tissue over time, from its formation to its mature state.","principled guide to action taken by the administrative executive branches of the state with regard to a class of issues","automatic control of transmission power in mobile phones","performing an act persistently and repetitively without it necessarily leading to an actual reward or pleasure","lattice point group","a variety of statistical techniques from data mining, predictive modelling, and machine learning, that analyze current and historical facts to make predictions about future or otherwise unknown events","account of past events in written records of religion","field of study",null,"Pollution that gets thrown in the oceans","actions to limit climate change in order to reduce the risks of global warming","statistical assessment of whether observations reflect a pattern rather than just chance","class of statistical survival models","simultaneous flow of materials with two or more thermodynamic phases","prevention of workplace hazards","form of corporate self-regulation integrated into a business model",null,"set of rules which seek, for humanitarian reasons, to limit the effects of armed conflict","policies to assist disadvantaged regions","risk of collapse of an entire financial system or entire market, as opposed to specific risk associated with any one individual entity, group or component of a system","ability to attribute mental states","exploration of the cognitive processes within organisms and the behavioral interactions between organisms in the natural world",null,null,"standard"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>display_name<\/th>\n      <th>level<\/th>\n      <th>works_count<\/th>\n      <th>works_api_url<\/th>\n      <th>description<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>What we end up is a list of concepts, related to which are different
‘works’, or specific citations. We can extract the works from those
concepts below. I currently break this into two extraction rounds, small
and large, because they need to be handled differently. This extraction
c</p>
<pre class="r"><code>smallworks &lt;- filter(indexdf, works_count &lt; 1000000)

for(i in 52:nrow(smallworks)){
sapply(smallworks$id[i], FUN = function(x){
  extractWorks(mailto = &quot;belwood@ucdavis.edu&quot;,
             concept_page = x,
             dest_file = paste0(&quot;~/Box/govscienceuseR/openalex_index_gsp/&quot;, 
                              stringr::str_extract(x,&#39;[A-Za-z0-9]+$&#39;),
                              &quot;_2000_2020&quot;, &quot;.json.gz&quot;),
             per_page = 200, # must be between 1 and 200
             to_date = 2022,
             from_date = 2000,
             sleep_time = 0.5)

})
}</code></pre>
<pre class="r"><code>largeworks &lt;- filter(indexdf, works_count &gt;= 1000000)

for(i in 1:nrow(largeworks)){
  for(j in 2000:2022){
sapply(largeworks$id[i], FUN = function(x){
  extractWorks(mailto = &quot;belwood@ucdavis.edu&quot;,
             concept_page = x,
             dest_file = paste0(&quot;~/Box/govscienceuseR/openalex_index_gsp/&quot;, 
                              stringr::str_extract(x,&#39;[A-Za-z0-9]+$&#39;),
                              &quot;_&quot;, j, &quot;.json.gz&quot;),
             per_page = 100,
             to_date = j,
             from_date = j,
             sleep_time = 0.5)

})
}
}</code></pre>
<pre class="r"><code>jsons &lt;- list.files(&quot;~/Box/govscienceuseR/openalex_index_gsp/&quot;, full.names = T)
# Anything that is 23 is empty
jsons &lt;- jsons[file.size(jsons) &gt; 23]
records &lt;- lapply(jsons, works2dt)
recordsdf &lt;- do.call(&quot;rbind&quot;, records)</code></pre>
<p>We’ve generated quite a wide database, including 1388002 records in
our index. However, this likely leaves out edge cases, and we are
developing ways to develop broader indices.</p>
</div>
<div id="referencesearch" class="section level3">
<h3>4. <code>referenceSearch</code></h3>
<p>Now we have our probable citations and their groupings, we have an
index to match them to, and now we want to probabilistically match
them.</p>
<p>Let’s isolate our probable citations that would likely map onto our
index of academic reference.</p>
<pre class="r"><code>dt_solr &lt;- dt %&gt;% 
  filter(class == &quot;journal&quot;) %&gt;% 
  select(title, author, year, publisher, container,  
         doi) %&gt;% 
  rename(&quot;journal_title&quot; = container,
         &quot;authors&quot; = author) %&gt;% 
  mutate(year = as.numeric(year))

queries &lt;- create_queries(dt_solr)</code></pre>
<p>This is where you’ll need your Solr instance running. In my terminal,
I am navigating to where Solr is housed, navigating to bin/solr and
starting a cloud instance with the command <code>start -c</code>.</p>
<pre class="bash"><code>~/Applications/solr-9.1.0/bin/solr start -c</code></pre>
<pre><code>## *** [WARN] *** Your open file limit is currently 12800.  
##  It should be set to 65000 to avoid operational disruption. 
##  If you no longer wish to see this warning, set SOLR_ULIMIT_CHECKS to false in your profile or solr.in.sh
## *** [WARN] ***  Your Max Processes Limit is currently 2784. 
##  It should be set to 65000 to avoid operational disruption. 
##  If you no longer wish to see this warning, set SOLR_ULIMIT_CHECKS to false in your profile or solr.in.sh
## Waiting up to 180 seconds to see Solr running on port 8983 [|]   [/]   [-]   [\]   [|]   [/]   [-]   [\]   [|]   [/]   [-]   [\]   [|]   [/]   [-]   [\]   [|]   [/]   [-]   [\]   [|]  
## Started Solr server on port 8983 (pid=8123). Happy searching!
## 
##     </code></pre>
<pre class="r"><code>#records &lt;- &quot;~/Box/govscienceuseR/openalex_index_gsp/&quot;
colnames(recordsdf)[c(1,2,3,5,7,8,10,12)] &lt;- c(&quot;source&quot;, &quot;title&quot;, &quot;doi&quot;, 
                                               &quot;year&quot;, &quot;miscid&quot;,
                                           &quot;journal_title&quot;,
                                           &quot;publisher&quot;, &quot;authors&quot;)</code></pre>
<pre class="r"><code>index_records(recordsdf, collection_name = &quot;gsp_index&quot;, overwrite = T)</code></pre>
<p>This does not run, I get ” Error: 400 - undefined field year ”</p>
<pre class="r"><code>results &lt;- search_collection(q = queries[3], 
                                   collection_name = &quot;WOS_demo&quot;, 
                                   topn = 3)</code></pre>
<p>Waiting to run then, then</p>
<pre class="r"><code>results = list()
count = 1
for (q in queries[1:10]) {
  res = search_collection(q, collection_name = &quot;gsp_index&quot;)
  res$id = count
  res$q = q
  results[[count]] = res
  count = count + 1
}
results_df = do.call(dplyr::bind_rows, results)</code></pre>
<p>Close out your Solr instance in the terminal:</p>
<pre class="bash"><code>~/Applications/solr-9.1.0/bin/solr stop</code></pre>
<pre><code>## Sending stop command to Solr running on port 8983 ... waiting up to 180 seconds to allow Jetty process 8123 to stop gracefully.
##  [|]   [/]   [-]   [\]      </code></pre>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
